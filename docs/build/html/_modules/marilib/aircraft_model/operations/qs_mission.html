
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>marilib.aircraft_model.operations.qs_mission &#8212; MARILib 1.0.0 documentation</title>
    <link rel="stylesheet" href="../../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">MARILib 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../marilib.html" accesskey="U">marilib</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for marilib.aircraft_model.operations.qs_mission</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Thu Jan 24 23:22:21 2019</span>

<span class="sd">@author: DRUOT Thierry</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">from</span> <span class="nn">marilib</span> <span class="k">import</span> <span class="n">numpy</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">marilib</span> <span class="k">import</span> <span class="n">fsolve</span>
<span class="kn">from</span> <span class="nn">marilib.tools.math</span> <span class="k">import</span> <span class="n">maximize_1d</span><span class="p">,</span> <span class="n">trinome</span>
<span class="kn">from</span> <span class="nn">marilib.tools</span> <span class="k">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">unit</span>

<span class="kn">from</span> <span class="nn">marilib.earth</span> <span class="k">import</span> <span class="n">environment</span> <span class="k">as</span> <span class="n">earth</span>
<span class="kn">from</span> <span class="nn">marilib.earth</span> <span class="k">import</span> <span class="n">environment_grad</span> <span class="k">as</span> <span class="n">g_earth</span>
<span class="kn">from</span> <span class="nn">marilib.aircraft_model.airplane</span> <span class="k">import</span> <span class="n">aerodynamics</span> <span class="k">as</span> <span class="n">airplane_aero</span>
<span class="kn">from</span> <span class="nn">marilib.airplane.propulsion</span> <span class="k">import</span> <span class="n">propulsion_models</span> <span class="k">as</span> <span class="n">propu</span>
<span class="kn">from</span> <span class="nn">marilib.aircraft_model.operations</span> <span class="k">import</span> <span class="n">flight_mechanics</span> <span class="k">as</span> <span class="n">flight</span>

<span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;mass&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;xg&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;zg&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;vgnd&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span>

<span class="n">xout_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;mass&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;xg&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;zg&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;vgnd&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
             <span class="s2">&quot;time_d&quot;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;mass_d&quot;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;xg_d&quot;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;zg_d&quot;</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;vgnd_d&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;path_d&quot;</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span>
             <span class="s2">&quot;vxgnd_d&quot;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;vzgnd_d&quot;</span><span class="p">:</span><span class="mi">13</span><span class="p">,</span>
             <span class="s2">&quot;vair&quot;</span><span class="p">:</span><span class="mi">14</span><span class="p">,</span> <span class="s2">&quot;vair_d&quot;</span><span class="p">:</span><span class="mi">15</span><span class="p">,</span> <span class="s2">&quot;vxair&quot;</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;vxair_d&quot;</span><span class="p">:</span><span class="mi">17</span><span class="p">,</span> <span class="s2">&quot;vzair&quot;</span><span class="p">:</span><span class="mi">18</span><span class="p">,</span> <span class="s2">&quot;vzair_d&quot;</span><span class="p">:</span><span class="mi">19</span><span class="p">,</span>
             <span class="s2">&quot;mach&quot;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;mach_d&quot;</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span> <span class="s2">&quot;vcas&quot;</span><span class="p">:</span><span class="mi">22</span><span class="p">,</span> <span class="s2">&quot;vcas_d&quot;</span><span class="p">:</span><span class="mi">23</span><span class="p">,</span>
             <span class="s2">&quot;altp&quot;</span><span class="p">:</span><span class="mi">24</span><span class="p">,</span> <span class="s2">&quot;altp_d&quot;</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span> <span class="s2">&quot;pamb&quot;</span><span class="p">:</span><span class="mi">26</span><span class="p">,</span> <span class="s2">&quot;pamb_d&quot;</span><span class="p">:</span><span class="mi">27</span><span class="p">,</span>
             <span class="s2">&quot;tamb&quot;</span><span class="p">:</span><span class="mi">28</span><span class="p">,</span> <span class="s2">&quot;tamb_d&quot;</span><span class="p">:</span><span class="mi">29</span><span class="p">,</span> <span class="s2">&quot;disa&quot;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span> <span class="s2">&quot;disa_d&quot;</span><span class="p">:</span><span class="mi">31</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">:</span><span class="mi">32</span><span class="p">,</span> <span class="s2">&quot;rho_d&quot;</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span>
             <span class="s2">&quot;wx&quot;</span><span class="p">:</span><span class="mi">34</span><span class="p">,</span> <span class="s2">&quot;wx_d&quot;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span> <span class="s2">&quot;wz&quot;</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span> <span class="s2">&quot;wz_d&quot;</span><span class="p">:</span><span class="mi">37</span><span class="p">,</span>
             <span class="s2">&quot;cz&quot;</span><span class="p">:</span><span class="mi">38</span><span class="p">,</span> <span class="s2">&quot;cx&quot;</span><span class="p">:</span><span class="mi">39</span><span class="p">,</span> <span class="s2">&quot;fn&quot;</span><span class="p">:</span><span class="mi">40</span><span class="p">}</span>


<span class="c1">#===========================================================================================================</span>
<div class="viewcode-block" id="cabin_virtual_altp"><a class="viewcode-back" href="../../../../api/marilib.aircraft_model.operations.qs_mission.html#marilib.aircraft_model.operations.qs_mission.cabin_virtual_altp">[docs]</a><span class="k">def</span> <span class="nf">cabin_virtual_altp</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Virtual pressure altitude of the cabin</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">altp_cabin</span> <span class="o">=</span> <span class="mf">2000.</span>
    <span class="k">return</span> <span class="n">altp_cabin</span></div>


<span class="c1">#===========================================================================================================</span>
<div class="viewcode-block" id="cabin_pressure_grad"><a class="viewcode-back" href="../../../../api/marilib.aircraft_model.operations.qs_mission.html#marilib.aircraft_model.operations.qs_mission.cabin_pressure_grad">[docs]</a><span class="k">def</span> <span class="nf">cabin_pressure_grad</span><span class="p">(</span><span class="n">altp_d</span><span class="p">):</span>

    <span class="n">disa</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">disa_d</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">altp</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="n">pamb</span><span class="p">,</span><span class="n">pamb_d</span><span class="p">,</span><span class="n">tamb</span><span class="p">,</span><span class="n">tamb_d</span><span class="p">,</span><span class="n">dtodz</span> <span class="o">=</span> <span class="n">g_earth</span><span class="o">.</span><span class="n">atmosphere_grad</span><span class="p">(</span><span class="n">altp</span><span class="p">,</span><span class="n">altp_d</span><span class="p">,</span><span class="n">disa</span><span class="p">,</span><span class="n">disa_d</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pamb_d</span></div>


<span class="c1">#===========================================================================================================</span>
<div class="viewcode-block" id="air"><a class="viewcode-back" href="../../../../api/marilib.aircraft_model.operations.qs_mission.html#marilib.aircraft_model.operations.qs_mission.air">[docs]</a><span class="k">def</span> <span class="nf">air</span><span class="p">(</span><span class="n">xg</span><span class="p">,</span><span class="n">zg</span><span class="p">,</span> <span class="n">xg_d</span><span class="p">,</span><span class="n">zg_d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Air field description : pressure, temperature and wind versus position and speed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">disa</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">disa_d</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="n">pamb</span><span class="p">,</span><span class="n">pamb_d</span><span class="p">,</span><span class="n">tamb</span><span class="p">,</span><span class="n">tamb_d</span><span class="p">,</span><span class="n">dtodz</span><span class="p">,</span><span class="n">dtodz_d</span> <span class="o">=</span> <span class="n">g_earth</span><span class="o">.</span><span class="n">atmosphere_geo_grad</span><span class="p">(</span><span class="n">zg</span><span class="p">,</span><span class="n">zg_d</span><span class="p">,</span><span class="n">disa</span><span class="p">,</span><span class="n">disa_d</span><span class="p">)</span><span class="c1"># Standard atmosphere</span>

    <span class="n">wx</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">wx_d</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="n">wz</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">wz_d</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="k">return</span> <span class="n">pamb</span><span class="p">,</span><span class="n">pamb_d</span><span class="p">,</span> <span class="n">tamb</span><span class="p">,</span><span class="n">tamb_d</span><span class="p">,</span> <span class="n">disa</span><span class="p">,</span><span class="n">disa_d</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span><span class="n">wx_d</span><span class="p">,</span> <span class="n">wz</span><span class="p">,</span><span class="n">wz_d</span></div>


<span class="c1">#===========================================================================================================</span>
<div class="viewcode-block" id="state_dot"><a class="viewcode-back" href="../../../../api/marilib.aircraft_model.operations.qs_mission.html#marilib.aircraft_model.operations.qs_mission.state_dot">[docs]</a><span class="k">def</span> <span class="nf">state_dot</span><span class="p">(</span><span class="n">xin</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">rating</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">aircraft</span><span class="p">):</span>

    <span class="n">g</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">gravity</span><span class="p">()</span>
    <span class="n">gam</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">heat_ratio</span><span class="p">()</span>

    <span class="n">area</span> <span class="o">=</span> <span class="n">aircraft</span><span class="o">.</span><span class="n">wing</span><span class="o">.</span><span class="n">area</span>

    <span class="n">cz</span><span class="p">,</span><span class="n">fn</span> <span class="o">=</span> <span class="n">xin</span>
    <span class="n">t</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">xg</span><span class="p">,</span><span class="n">zg</span><span class="p">,</span><span class="n">vgnd</span><span class="p">,</span><span class="n">path</span> <span class="o">=</span> <span class="n">state</span>

    <span class="n">xg_d</span> <span class="o">=</span> <span class="n">vgnd</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">zg_d</span> <span class="o">=</span> <span class="n">vgnd</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="n">pamb</span><span class="p">,</span><span class="n">pamb_d</span><span class="p">,</span> <span class="n">tamb</span><span class="p">,</span><span class="n">tamb_d</span><span class="p">,</span> <span class="n">disa</span><span class="p">,</span><span class="n">disa_d</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span><span class="n">wx_d</span><span class="p">,</span> <span class="n">wz</span><span class="p">,</span><span class="n">wz_d</span> <span class="o">=</span> <span class="n">air</span><span class="p">(</span><span class="n">xg</span><span class="p">,</span><span class="n">zg</span><span class="p">,</span> <span class="n">xg_d</span><span class="p">,</span><span class="n">zg_d</span><span class="p">)</span>

    <span class="n">rho</span><span class="p">,</span><span class="n">rho_d</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span><span class="n">sig_d</span> <span class="o">=</span> <span class="n">g_earth</span><span class="o">.</span><span class="n">air_density_grad</span><span class="p">(</span><span class="n">pamb</span><span class="p">,</span><span class="n">pamb_d</span><span class="p">,</span> <span class="n">tamb</span><span class="p">,</span><span class="n">tamb_d</span><span class="p">)</span>

    <span class="n">vsnd</span><span class="p">,</span><span class="n">vsnd_d</span> <span class="o">=</span> <span class="n">g_earth</span><span class="o">.</span><span class="n">sound_speed_grad</span><span class="p">(</span><span class="n">tamb</span><span class="p">,</span><span class="n">tamb_d</span><span class="p">)</span>

    <span class="n">altp</span><span class="p">,</span><span class="n">altp_d</span> <span class="o">=</span> <span class="n">g_earth</span><span class="o">.</span><span class="n">pressure_altitude_grad</span><span class="p">(</span><span class="n">pamb</span><span class="p">,</span><span class="n">pamb_d</span><span class="p">)</span>

<span class="c1"># Compute state_dot</span>
<span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="n">vxair</span> <span class="o">=</span> <span class="n">xg_d</span> <span class="o">-</span> <span class="n">wx</span>   <span class="c1"># Local wind is introduced here</span>
    <span class="n">vzair</span> <span class="o">=</span> <span class="n">zg_d</span> <span class="o">-</span> <span class="n">wz</span>

    <span class="n">vair</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vxair</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vzair</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">mach</span> <span class="o">=</span> <span class="n">vair</span><span class="o">/</span><span class="n">vsnd</span>

    <span class="n">cx</span><span class="p">,</span><span class="n">lod</span> <span class="o">=</span> <span class="n">airplane_aero</span><span class="o">.</span><span class="n">drag</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">pamb</span><span class="p">,</span><span class="n">tamb</span><span class="p">,</span><span class="n">mach</span><span class="p">,</span><span class="n">cz</span><span class="p">)</span>    <span class="c1"># Aerodynamic drag model</span>

    <span class="n">path_d</span> <span class="o">=</span> <span class="p">((</span><span class="mf">0.5</span><span class="o">*</span><span class="n">rho</span><span class="o">*</span><span class="n">vair</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">area</span><span class="o">*</span><span class="n">cz</span> <span class="o">-</span> <span class="n">mass</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">path</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">mass</span><span class="o">*</span><span class="n">vair</span><span class="p">)</span>    <span class="c1"># Lift equation</span>
    <span class="n">vgnd_d</span> <span class="o">=</span> <span class="p">(</span><span class="n">fn</span> <span class="o">-</span> <span class="n">mass</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">rho</span><span class="o">*</span><span class="n">vair</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">area</span><span class="o">*</span><span class="n">cx</span><span class="p">)</span><span class="o">/</span><span class="n">mass</span>      <span class="c1"># Drag equation</span>

    <span class="n">sfc</span> <span class="o">=</span> <span class="n">propu</span><span class="o">.</span><span class="n">sfc</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">pamb</span><span class="p">,</span><span class="n">tamb</span><span class="p">,</span><span class="n">mach</span><span class="p">,</span><span class="n">rating</span><span class="p">,</span><span class="n">fn</span><span class="p">,</span><span class="n">nei</span><span class="p">)</span>     <span class="c1"># Propulsion consumption model</span>

    <span class="n">mass_d</span> <span class="o">=</span> <span class="o">-</span><span class="n">sfc</span><span class="o">*</span><span class="n">fn</span>

    <span class="n">state_d</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span><span class="n">mass_d</span><span class="p">,</span><span class="n">xg_d</span><span class="p">,</span><span class="n">zg_d</span><span class="p">,</span><span class="n">vgnd_d</span><span class="p">,</span><span class="n">path_d</span><span class="p">])</span>

<span class="c1"># Compute other derivatives</span>
<span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="n">vxgnd_d</span> <span class="o">=</span> <span class="n">vgnd_d</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">-</span> <span class="n">vgnd</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">*</span><span class="n">path_d</span>
    <span class="n">vzgnd_d</span> <span class="o">=</span> <span class="n">vgnd_d</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">+</span> <span class="n">vgnd</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">*</span><span class="n">path_d</span>

    <span class="n">vxair_d</span> <span class="o">=</span> <span class="n">vxgnd_d</span> <span class="o">-</span> <span class="n">wx_d</span>
    <span class="n">vzair_d</span> <span class="o">=</span> <span class="n">vzgnd_d</span> <span class="o">-</span> <span class="n">wz_d</span>

    <span class="n">vair_d</span> <span class="o">=</span> <span class="p">(</span><span class="n">vxair</span><span class="o">*</span><span class="n">vxair_d</span> <span class="o">+</span> <span class="n">vzair</span><span class="o">*</span><span class="n">vzair_d</span><span class="p">)</span><span class="o">/</span><span class="n">vair</span>
    <span class="n">mach_d</span> <span class="o">=</span> <span class="n">vair_d</span><span class="o">/</span><span class="n">vsnd</span> <span class="o">-</span> <span class="n">vair</span><span class="o">*</span><span class="n">vsnd_d</span><span class="o">/</span><span class="n">vsnd</span><span class="o">**</span><span class="mi">2</span>

    <span class="n">vcas</span><span class="p">,</span><span class="n">vcas_d</span> <span class="o">=</span> <span class="n">g_earth</span><span class="o">.</span><span class="n">vcas_from_mach_grad</span><span class="p">(</span><span class="n">pamb</span><span class="p">,</span><span class="n">pamb_d</span><span class="p">,</span> <span class="n">mach</span><span class="p">,</span><span class="n">mach_d</span><span class="p">)</span>

    <span class="n">xout</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">t</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">xg</span><span class="p">,</span><span class="n">zg</span><span class="p">,</span><span class="n">vgnd</span><span class="p">,</span><span class="n">path</span><span class="p">,</span>
                        <span class="mf">1.</span><span class="p">,</span><span class="n">mass_d</span><span class="p">,</span><span class="n">xg_d</span><span class="p">,</span><span class="n">zg_d</span><span class="p">,</span><span class="n">vgnd_d</span><span class="p">,</span><span class="n">path_d</span><span class="p">,</span>
                        <span class="n">vxgnd_d</span><span class="p">,</span><span class="n">vzgnd_d</span><span class="p">,</span>
                        <span class="n">vair</span><span class="p">,</span><span class="n">vair_d</span><span class="p">,</span> <span class="n">vxair</span><span class="p">,</span><span class="n">vxair_d</span><span class="p">,</span> <span class="n">vzair</span><span class="p">,</span><span class="n">vzair_d</span><span class="p">,</span>
                        <span class="n">mach</span><span class="p">,</span><span class="n">mach_d</span><span class="p">,</span> <span class="n">vcas</span><span class="p">,</span><span class="n">vcas_d</span><span class="p">,</span>
                        <span class="n">altp</span><span class="p">,</span><span class="n">altp_d</span><span class="p">,</span> <span class="n">pamb</span><span class="p">,</span><span class="n">pamb_d</span><span class="p">,</span>
                        <span class="n">tamb</span><span class="p">,</span><span class="n">tamb_d</span><span class="p">,</span> <span class="n">disa</span><span class="p">,</span><span class="n">disa_d</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span><span class="n">rho_d</span><span class="p">,</span>
                        <span class="n">wx</span><span class="p">,</span><span class="n">wx_d</span><span class="p">,</span> <span class="n">wz</span><span class="p">,</span><span class="n">wz_d</span><span class="p">,</span>
                        <span class="n">cz</span><span class="p">,</span><span class="n">cx</span><span class="p">,</span><span class="n">fn</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">xout</span><span class="p">,</span><span class="n">state_d</span></div>


<span class="c1">#===========================================================================================================</span>
<div class="viewcode-block" id="fct_thrust"><a class="viewcode-back" href="../../../../api/marilib.aircraft_model.operations.qs_mission.html#marilib.aircraft_model.operations.qs_mission.fct_thrust">[docs]</a><span class="k">def</span> <span class="nf">fct_thrust</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">rating</span><span class="p">,</span><span class="n">nei</span><span class="p">):</span>

    <span class="n">xg</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;xg&quot;</span><span class="p">]]</span>
    <span class="n">zg</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;zg&quot;</span><span class="p">]]</span>

    <span class="n">xg_d</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;vgnd&quot;</span><span class="p">]]</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]])</span>
    <span class="n">zg_d</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;vgnd&quot;</span><span class="p">]]</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]])</span>

    <span class="n">pamb</span><span class="p">,</span><span class="n">pamb_d</span><span class="p">,</span> <span class="n">tamb</span><span class="p">,</span><span class="n">tamb_d</span><span class="p">,</span> <span class="n">disa</span><span class="p">,</span><span class="n">disa_d</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span><span class="n">wx_d</span><span class="p">,</span> <span class="n">wz</span><span class="p">,</span><span class="n">wz_d</span> <span class="o">=</span> <span class="n">air</span><span class="p">(</span><span class="n">xg</span><span class="p">,</span><span class="n">zg</span><span class="p">,</span> <span class="n">xg_d</span><span class="p">,</span><span class="n">zg_d</span><span class="p">)</span>

    <span class="n">vsnd</span><span class="p">,</span><span class="n">vsnd_d</span> <span class="o">=</span> <span class="n">g_earth</span><span class="o">.</span><span class="n">sound_speed_grad</span><span class="p">(</span><span class="n">tamb</span><span class="p">,</span><span class="n">tamb_d</span><span class="p">)</span>

    <span class="n">vair</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">xg_d</span> <span class="o">-</span> <span class="n">wx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">zg_d</span> <span class="o">-</span> <span class="n">wz</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">mach</span> <span class="o">=</span> <span class="n">vair</span><span class="o">/</span><span class="n">vsnd</span>

    <span class="n">throttle</span> <span class="o">=</span> <span class="mf">1.</span>

    <span class="n">fn</span><span class="p">,</span><span class="n">sfc</span><span class="p">,</span><span class="n">sec</span><span class="p">,</span><span class="n">data</span> <span class="o">=</span> <span class="n">propu</span><span class="o">.</span><span class="n">thrust</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">pamb</span><span class="p">,</span><span class="n">tamb</span><span class="p">,</span><span class="n">mach</span><span class="p">,</span><span class="n">rating</span><span class="p">,</span><span class="n">throttle</span><span class="p">,</span><span class="n">nei</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fn</span></div>


<span class="c1">#===========================================================================================================</span>
<div class="viewcode-block" id="flight_point"><a class="viewcode-back" href="../../../../api/marilib.aircraft_model.operations.qs_mission.html#marilib.aircraft_model.operations.qs_mission.flight_point">[docs]</a><span class="k">def</span> <span class="nf">flight_point</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">rating</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="nb">input</span><span class="p">,</span><span class="n">dat</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="n">cst</span><span class="p">):</span>

    <span class="c1">#===========================================================================================================</span>
    <span class="k">def</span> <span class="nf">fct_flight_point</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="nb">input</span><span class="p">,</span><span class="n">dat</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="n">cst</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">rating</span><span class="p">,</span><span class="n">aircraft</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_dat</span><span class="p">):</span>
            <span class="n">param</span><span class="p">[</span><span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cmd</span><span class="p">):</span>
             <span class="n">param</span><span class="p">[</span><span class="n">cmd</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">xin</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;cz&quot;</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;fn&quot;</span><span class="p">]])</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_dof</span><span class="p">):</span>
            <span class="n">state</span><span class="p">[</span><span class="n">state_dict</span><span class="p">[</span><span class="n">dof</span><span class="p">[</span><span class="n">i</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="n">n_cmd</span><span class="o">+</span><span class="n">i</span><span class="p">]</span>

        <span class="n">xout</span><span class="p">,</span><span class="n">state_d</span> <span class="o">=</span> <span class="n">state_dot</span><span class="p">(</span><span class="n">xin</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">rating</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">aircraft</span><span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">n_cst</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cst</span><span class="p">):</span>
            <span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xout</span><span class="p">[</span><span class="n">xout_dict</span><span class="p">[</span><span class="n">cst</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]]</span> <span class="o">-</span> <span class="nb">eval</span><span class="p">(</span><span class="n">cst</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">res</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Initialize level flight</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="n">n_dat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">dat</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_cmd</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">cmd</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_dof</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">dof</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_cst</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">cst</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cz&quot;</span><span class="p">:</span><span class="mf">0.</span><span class="p">,</span><span class="s2">&quot;fn&quot;</span><span class="p">:</span><span class="mf">0.</span><span class="p">}</span>

    <span class="n">fct_args</span> <span class="o">=</span> <span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="nb">input</span><span class="p">,</span><span class="n">dat</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="n">cst</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">rating</span><span class="p">,</span><span class="n">aircraft</span><span class="p">)</span>

    <span class="n">out_dict</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">fct_flight_point</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">fct_args</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">rei</span> <span class="o">=</span> <span class="n">out_dict</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span><span class="p">(</span><span class="n">rei</span><span class="o">!=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Impossible to converge flight point&quot;</span><span class="p">,</span><span class="n">unit</span><span class="o">.</span><span class="n">NM_m</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;xg&quot;</span><span class="p">]]))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_dat</span><span class="p">):</span>
        <span class="n">param</span><span class="p">[</span><span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cmd</span><span class="p">):</span>
        <span class="n">param</span><span class="p">[</span><span class="n">cmd</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">out_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

    <span class="n">xin</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;cz&quot;</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;fn&quot;</span><span class="p">]])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_dof</span><span class="p">):</span>
        <span class="n">state</span><span class="p">[</span><span class="n">state_dict</span><span class="p">[</span><span class="n">dof</span><span class="p">[</span><span class="n">i</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">out_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">n_cmd</span><span class="o">+</span><span class="n">i</span><span class="p">]</span>

    <span class="n">xout</span><span class="p">,</span><span class="n">state_d</span> <span class="o">=</span> <span class="n">state_dot</span><span class="p">(</span><span class="n">xin</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">rating</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">aircraft</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">xout</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">state_d</span></div>


<span class="c1">#===========================================================================================================</span>
<div class="viewcode-block" id="flight_segment"><a class="viewcode-back" href="../../../../api/marilib.aircraft_model.operations.qs_mission.html#marilib.aircraft_model.operations.qs_mission.flight_segment">[docs]</a><span class="k">def</span> <span class="nf">flight_segment</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">rating</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="nb">input</span><span class="p">,</span><span class="n">dat</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="n">cst</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">flight</span><span class="p">):</span>

    <span class="c1"># Initialize level flight</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="n">xout</span> <span class="o">=</span> <span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>

    <span class="n">var</span> <span class="o">=</span> <span class="n">init_var</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">)</span>

    <span class="n">stop_idx</span> <span class="o">=</span> <span class="n">xout_dict</span><span class="p">[</span><span class="n">stop</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">stop_val</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">stop</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">stop</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Play level flight</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;xout[stop_idx]&quot;</span><span class="o">+</span><span class="n">op</span><span class="o">+</span><span class="s2">&quot;stop_val&quot;</span><span class="p">)):</span>

        <span class="n">xout</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">state_d</span> <span class="o">=</span> <span class="n">flight_point</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">rating</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="nb">input</span><span class="p">,</span><span class="n">dat</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="n">cst</span><span class="p">)</span>

        <span class="n">flight</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">flight</span><span class="p">,</span><span class="n">xout</span><span class="p">])</span>

        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span> <span class="o">+</span> <span class="n">state_d</span><span class="o">*</span><span class="n">dt</span>

    <span class="c1"># Adjust last point using interpolation</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="n">xout</span> <span class="o">=</span> <span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">+</span> <span class="p">(</span><span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span><span class="o">-</span><span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,:])</span> \
                         <span class="o">*</span><span class="p">(</span><span class="n">stop_val</span> <span class="o">-</span> <span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">xout_dict</span><span class="p">[</span><span class="n">stop</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])</span> \
                         <span class="o">/</span><span class="p">(</span><span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">xout_dict</span><span class="p">[</span><span class="n">stop</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span> <span class="o">-</span> <span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">xout_dict</span><span class="p">[</span><span class="n">stop</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])</span>

    <span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">xout</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">xout</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">flight</span><span class="p">,</span><span class="n">state</span></div>


<span class="c1">#===========================================================================================================</span>
<div class="viewcode-block" id="iso_cas_climb"><a class="viewcode-back" href="../../../../api/marilib.aircraft_model.operations.qs_mission.html#marilib.aircraft_model.operations.qs_mission.iso_cas_climb">[docs]</a><span class="k">def</span> <span class="nf">iso_cas_climb</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">vcas1</span><span class="p">,</span><span class="n">altp1</span><span class="p">,</span><span class="n">vcas2</span><span class="p">,</span><span class="n">altp2</span><span class="p">,</span><span class="n">mach</span><span class="p">,</span><span class="n">vz_mcl_min</span><span class="p">,</span><span class="n">flight</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constant CAS climb :</span>
<span class="sd">    vcas1 from altp0 to altp1</span>
<span class="sd">    vcas2 from alpt1 to lower altitude from altp2 and crossover altitude with iso mach</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Initialize climb flight</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="n">xout</span> <span class="o">=</span> <span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">xout</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
    <span class="n">altp0</span> <span class="o">=</span> <span class="n">xout</span><span class="p">[</span><span class="n">xout_dict</span><span class="p">[</span><span class="s2">&quot;altp&quot;</span><span class="p">]]</span>

    <span class="n">altp_cross_over</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">cross_over_altp</span><span class="p">(</span><span class="n">vcas2</span><span class="p">,</span><span class="n">mach</span><span class="p">)</span>

    <span class="n">altp_stop</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">altp2</span><span class="p">,</span><span class="n">altp_cross_over</span><span class="p">)</span>

    <span class="p">(</span><span class="n">MTO</span><span class="p">,</span><span class="n">MCN</span><span class="p">,</span><span class="n">MCL</span><span class="p">,</span><span class="n">MCR</span><span class="p">,</span><span class="n">FID</span><span class="p">)</span> <span class="o">=</span> <span class="n">aircraft</span><span class="o">.</span><span class="n">propulsion</span><span class="o">.</span><span class="n">rating_code</span>
    <span class="n">nei</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="c1"># Data filtering</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="k">if</span><span class="p">(</span><span class="n">vcas1</span><span class="o">&gt;</span><span class="n">vcas2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;iso_cas_climb, vcas2 must be higher or equal than vcas1&quot;</span><span class="p">)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">altp0</span><span class="o">&gt;</span><span class="n">altp1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;iso_cas_climb, altp1 must be higher than starting altitude&quot;</span><span class="p">)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">altp1</span><span class="o">&gt;</span><span class="n">altp2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;iso_cas_climb, altp2 must be higher than altp1&quot;</span><span class="p">)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">altp1</span><span class="o">&gt;</span><span class="n">altp_cross_over</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;iso_cas_climb, cross over altitude must be higher than altp1&quot;</span><span class="p">)</span>

    <span class="c1"># First climb segment</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">vcas1</span><span class="p">,</span><span class="n">altp1</span><span class="p">])</span>
    <span class="n">dat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;fn&quot;</span><span class="p">,</span><span class="s2">&quot;fct_thrust(aircraft,state,rating,nei)&quot;</span><span class="p">]])</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;cz&quot;</span><span class="p">])</span>
    <span class="n">dof</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;vgnd&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
    <span class="n">cst</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;vcas&quot;</span><span class="p">,</span><span class="s2">&quot;input[0]&quot;</span><span class="p">],[</span><span class="s2">&quot;vcas_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">],[</span><span class="s2">&quot;path_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">]])</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;altp&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="s2">&quot;input[1]&quot;</span><span class="p">])</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">30.</span>

    <span class="n">flight</span><span class="p">,</span><span class="n">state</span> <span class="o">=</span> <span class="n">flight_segment</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">MCL</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="nb">input</span><span class="p">,</span><span class="n">dat</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="n">cst</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">flight</span><span class="p">)</span>

    <span class="c1"># Acceleration at constant altitude</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">altp1</span><span class="p">,</span><span class="n">vcas2</span><span class="p">])</span>
    <span class="n">dat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;fn&quot;</span><span class="p">,</span><span class="s2">&quot;fct_thrust(aircraft,state,rating,nei)&quot;</span><span class="p">]])</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;cz&quot;</span><span class="p">])</span>
    <span class="n">dof</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;zg&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
    <span class="n">cst</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;altp&quot;</span><span class="p">,</span><span class="s2">&quot;input[0]&quot;</span><span class="p">],[</span><span class="s2">&quot;altp_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">],[</span><span class="s2">&quot;path_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">]])</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;vcas&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="s2">&quot;input[1]&quot;</span><span class="p">])</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">5.</span>

    <span class="n">flight</span><span class="p">,</span><span class="n">state</span> <span class="o">=</span> <span class="n">flight_segment</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">MCL</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="nb">input</span><span class="p">,</span><span class="n">dat</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="n">cst</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">flight</span><span class="p">)</span>

    <span class="c1"># Second climb segment</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">vcas2</span><span class="p">,</span><span class="n">altp_stop</span><span class="p">])</span>
    <span class="n">dat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;fn&quot;</span><span class="p">,</span><span class="s2">&quot;fct_thrust(aircraft,state,rating,nei)&quot;</span><span class="p">]])</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;cz&quot;</span><span class="p">])</span>
    <span class="n">dof</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;vgnd&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
    <span class="n">cst</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;vcas&quot;</span><span class="p">,</span><span class="s2">&quot;input[0]&quot;</span><span class="p">],[</span><span class="s2">&quot;vcas_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">],[</span><span class="s2">&quot;path_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">]])</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;altp&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="s2">&quot;input[1]&quot;</span><span class="p">])</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">30.</span>

    <span class="n">flight</span><span class="p">,</span><span class="n">state</span> <span class="o">=</span> <span class="n">flight_segment</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">MCL</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="nb">input</span><span class="p">,</span><span class="n">dat</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="n">cst</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">flight</span><span class="p">)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">xout_dict</span><span class="p">[</span><span class="s2">&quot;vzair&quot;</span><span class="p">]]</span><span class="o">&lt;</span><span class="n">vz_mcl_min</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;iso_cas_climb, final altitude cannot be reached with minimum required vertical speed&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">flight</span><span class="p">,</span><span class="n">state</span></div>


<span class="c1">#===========================================================================================================</span>
<div class="viewcode-block" id="level_flight"><a class="viewcode-back" href="../../../../api/marilib.aircraft_model.operations.qs_mission.html#marilib.aircraft_model.operations.qs_mission.level_flight">[docs]</a><span class="k">def</span> <span class="nf">level_flight</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">mach</span><span class="p">,</span><span class="n">vz_mcl_min</span><span class="p">,</span><span class="n">vz_mcr_min</span><span class="p">,</span><span class="n">heading</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="n">flight</span><span class="p">):</span>

    <span class="n">westbound</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">2000.</span><span class="p">,</span><span class="mf">41000.</span><span class="p">,</span><span class="mf">2000.</span><span class="p">),</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">43000.</span><span class="p">,</span><span class="mf">85000.</span><span class="p">,</span><span class="mf">4000.</span><span class="p">)))</span>
    <span class="n">eastbound</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1000.</span><span class="p">,</span><span class="mf">42000.</span><span class="p">,</span><span class="mf">2000.</span><span class="p">),</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">45000.</span><span class="p">,</span><span class="mf">87000.</span><span class="p">,</span><span class="mf">4000.</span><span class="p">)))</span>
    <span class="n">ladder</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;West&quot;</span><span class="p">:</span><span class="n">westbound</span><span class="p">,</span> <span class="s2">&quot;East&quot;</span><span class="p">:</span><span class="n">eastbound</span><span class="p">}</span>

    <span class="c1"># Initialize level flight</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="n">xout</span> <span class="o">=</span> <span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">xout</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
    <span class="n">altp</span> <span class="o">=</span> <span class="n">xout</span><span class="p">[</span><span class="n">xout_dict</span><span class="p">[</span><span class="s2">&quot;altp&quot;</span><span class="p">]]</span>
    <span class="n">altp_up</span> <span class="o">=</span> <span class="n">ladder</span><span class="p">[</span><span class="n">heading</span><span class="p">][</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ladder</span><span class="p">[</span><span class="n">heading</span><span class="p">]</span><span class="o">&gt;</span><span class="p">(</span><span class="n">altp</span><span class="o">+</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>      <span class="c1"># Lower altitude imediatly higher than altp1</span>

    <span class="p">(</span><span class="n">MTO</span><span class="p">,</span><span class="n">MCN</span><span class="p">,</span><span class="n">MCL</span><span class="p">,</span><span class="n">MCR</span><span class="p">,</span><span class="n">FID</span><span class="p">)</span> <span class="o">=</span> <span class="n">aircraft</span><span class="o">.</span><span class="n">propulsion</span><span class="o">.</span><span class="n">rating_code</span>
    <span class="n">nei</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="c1"># Test cruise ceiling</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="n">vz_mcr</span><span class="p">,</span><span class="n">vz_mcl</span> <span class="o">=</span> <span class="n">test_ceilings</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">mach</span><span class="p">,</span><span class="n">altp</span><span class="p">,</span><span class="n">state</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">vz_mcl</span> <span class="o">&lt;</span> <span class="n">vz_mcl_min</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot start level flight because of MCL ceiling&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">vz_mcr</span> <span class="o">&lt;</span> <span class="n">vz_mcr_min</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot start level flight because of MCR ceiling&quot;</span><span class="p">)</span>

    <span class="n">active_ceiling</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Initialize specific ranges</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="n">sar</span><span class="p">,</span><span class="n">sar_up</span> <span class="o">=</span> <span class="n">test_air_range</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">MCR</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">mach</span><span class="p">,</span><span class="n">altp</span><span class="p">,</span><span class="n">altp_up</span><span class="p">,</span><span class="n">state</span><span class="p">)</span>

    <span class="n">dtime</span> <span class="o">=</span> <span class="mf">0.</span>  <span class="c1"># Allows to start by a climb by merging transition point to last iso_cas climb</span>

    <span class="c1"># Fly step cruise</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="n">stop_idx</span> <span class="o">=</span> <span class="n">xout_dict</span><span class="p">[</span><span class="n">stop</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">stop_val</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">stop</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">stop</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">while</span> <span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;flight[-1,stop_idx]&quot;</span><span class="o">+</span><span class="n">op</span><span class="o">+</span><span class="s2">&quot;stop_val&quot;</span><span class="p">)):</span>

        <span class="n">sar0</span> <span class="o">=</span> <span class="n">sar</span>
        <span class="n">sar_up0</span> <span class="o">=</span> <span class="n">sar_up</span>

        <span class="n">sar</span><span class="p">,</span><span class="n">sar_up</span> <span class="o">=</span> <span class="n">test_air_range</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">MCR</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">mach</span><span class="p">,</span><span class="n">altp</span><span class="p">,</span><span class="n">altp_up</span><span class="p">,</span><span class="n">state</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">sar</span> <span class="o">&lt;</span> <span class="n">sar_up</span><span class="p">):</span>      <span class="c1"># Efficiency is better on upper level</span>

            <span class="n">vz_mcr</span><span class="p">,</span><span class="n">vz_mcl</span> <span class="o">=</span> <span class="n">test_ceilings</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">mach</span><span class="p">,</span><span class="n">altp_up</span><span class="p">,</span><span class="n">state</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">vz_mcr_min</span><span class="o">&lt;</span><span class="n">vz_mcr</span> <span class="ow">and</span> <span class="n">vz_mcl_min</span><span class="o">&lt;</span><span class="n">vz_mcl</span><span class="p">):</span>     <span class="c1"># Ceilings allow to climb</span>

                <span class="k">if</span> <span class="p">(</span><span class="mi">0</span><span class="o">&lt;</span><span class="n">active_ceiling</span><span class="p">):</span>
                    <span class="c1"># Compute transition point according to climb speed</span>
                    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">active_ceiling</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">time</span> <span class="o">=</span>  <span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">xout_dict</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]]</span> <span class="o">-</span> <span class="n">dtime</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">vz_mcr_min</span><span class="o">-</span><span class="n">active_vz</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">vz_mcr</span><span class="o">-</span><span class="n">vz_mcr_min</span><span class="p">)))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">time</span> <span class="o">=</span>  <span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">xout_dict</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]]</span> <span class="o">-</span> <span class="n">dtime</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">vz_mcl_min</span><span class="o">-</span><span class="n">active_vz</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">vz_mcl</span><span class="o">-</span><span class="n">vz_mcl_min</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Compute transition point according to SAR</span>
                    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
                    <span class="n">time</span> <span class="o">=</span>  <span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">xout_dict</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]]</span> <span class="o">-</span> <span class="n">dtime</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">sar0</span><span class="o">-</span><span class="n">sar_up0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sar_up</span><span class="o">-</span><span class="n">sar</span><span class="p">)))</span>

                <span class="n">xout</span> <span class="o">=</span> <span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">+</span> <span class="p">(</span><span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span><span class="o">-</span><span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,:])</span> \
                                     <span class="o">*</span><span class="p">(</span><span class="n">time</span> <span class="o">-</span> <span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">xout_dict</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]])</span> \
                                     <span class="o">/</span><span class="p">(</span><span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">xout_dict</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]]</span> <span class="o">-</span> <span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">xout_dict</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]])</span>

                <span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">xout</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">xout</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>

                <span class="c1"># Climb to upper altitude</span>
                <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="mf">30.</span>
                <span class="nb">input</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mach</span><span class="p">,</span><span class="n">altp_up</span><span class="p">])</span>
                <span class="n">dat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;fn&quot;</span><span class="p">,</span><span class="s2">&quot;fct_thrust(aircraft,state,rating,nei)&quot;</span><span class="p">]])</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;cz&quot;</span><span class="p">])</span>
                <span class="n">dof</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;vgnd&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
                <span class="n">cst</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;mach&quot;</span><span class="p">,</span><span class="s2">&quot;input[0]&quot;</span><span class="p">],[</span><span class="s2">&quot;mach_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">],[</span><span class="s2">&quot;path_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">]])</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;altp&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="s2">&quot;input[1]&quot;</span><span class="p">])</span>

                <span class="n">flight</span><span class="p">,</span><span class="n">state</span> <span class="o">=</span> <span class="n">flight_segment</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">MCL</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="nb">input</span><span class="p">,</span><span class="n">dat</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="n">cst</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">flight</span><span class="p">)</span>

                <span class="n">altp</span> <span class="o">=</span> <span class="n">altp_up</span>
                <span class="n">altp_up</span> <span class="o">=</span> <span class="n">ladder</span><span class="p">[</span><span class="n">heading</span><span class="p">][</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ladder</span><span class="p">[</span><span class="n">heading</span><span class="p">]</span><span class="o">&gt;</span><span class="p">(</span><span class="n">altp_up</span><span class="o">+</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>

                <span class="n">dtime</span> <span class="o">=</span> <span class="mf">0.</span>  <span class="c1"># Allows to continue climbing if best recheable altitude is not found for cruise start</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Detect the most constraining condition</span>
                <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">vz_mcl_min</span><span class="o">-</span><span class="n">vz_mcl</span><span class="p">)</span><span class="o">&lt;</span><span class="p">(</span><span class="n">vz_mcr_min</span><span class="o">-</span><span class="n">vz_mcr</span><span class="p">)):</span>
                    <span class="n">active_ceiling</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">active_vz</span> <span class="o">=</span> <span class="n">vz_mcr</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">active_ceiling</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="n">active_vz</span> <span class="o">=</span> <span class="n">vz_mcl</span>

                <span class="c1"># Go to next point</span>
                <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="mf">120.</span>
                <span class="n">time_stop</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="n">dt</span>
                <span class="nb">input</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">altp</span><span class="p">,</span><span class="n">mach</span><span class="p">,</span><span class="n">time_stop</span><span class="p">])</span>
                <span class="n">dat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;cz&quot;</span><span class="p">,</span><span class="s2">&quot;fn&quot;</span><span class="p">])</span>
                <span class="n">dof</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;zg&quot;</span><span class="p">,</span><span class="s2">&quot;vgnd&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
                <span class="n">cst</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;altp&quot;</span><span class="p">,</span><span class="s2">&quot;input[0]&quot;</span><span class="p">],[</span><span class="s2">&quot;altp_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">],[</span><span class="s2">&quot;mach&quot;</span><span class="p">,</span><span class="s2">&quot;input[1]&quot;</span><span class="p">],[</span><span class="s2">&quot;mach_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">],[</span><span class="s2">&quot;path_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">]])</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="s2">&quot;input[2]&quot;</span><span class="p">])</span>

                <span class="n">flight</span><span class="p">,</span><span class="n">state</span> <span class="o">=</span> <span class="n">flight_segment</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">MCR</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="nb">input</span><span class="p">,</span><span class="n">dat</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="n">cst</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">flight</span><span class="p">)</span>

                <span class="n">dtime</span> <span class="o">=</span> <span class="n">dt</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># Go to next point</span>
            <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="mf">120.</span>
            <span class="n">time_stop</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="n">dt</span>
            <span class="nb">input</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">altp</span><span class="p">,</span><span class="n">mach</span><span class="p">,</span><span class="n">time_stop</span><span class="p">])</span>
            <span class="n">dat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;cz&quot;</span><span class="p">,</span><span class="s2">&quot;fn&quot;</span><span class="p">])</span>
            <span class="n">dof</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;zg&quot;</span><span class="p">,</span><span class="s2">&quot;vgnd&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
            <span class="n">cst</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;altp&quot;</span><span class="p">,</span><span class="s2">&quot;input[0]&quot;</span><span class="p">],[</span><span class="s2">&quot;altp_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">],[</span><span class="s2">&quot;mach&quot;</span><span class="p">,</span><span class="s2">&quot;input[1]&quot;</span><span class="p">],[</span><span class="s2">&quot;mach_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">],[</span><span class="s2">&quot;path_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">]])</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="s2">&quot;input[2]&quot;</span><span class="p">])</span>

            <span class="n">flight</span><span class="p">,</span><span class="n">state</span> <span class="o">=</span> <span class="n">flight_segment</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">MCR</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="nb">input</span><span class="p">,</span><span class="n">dat</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="n">cst</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">flight</span><span class="p">)</span>

            <span class="n">dtime</span> <span class="o">=</span> <span class="n">dt</span>

    <span class="c1"># Adjust last point using interpolation</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">flight</span><span class="p">[:,</span><span class="n">stop_idx</span><span class="p">]</span><span class="o">&lt;</span><span class="n">stop_val</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">xout</span> <span class="o">=</span> <span class="n">flight</span><span class="p">[</span><span class="n">n</span><span class="p">,:]</span> <span class="o">+</span> <span class="p">(</span><span class="n">flight</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,:]</span><span class="o">-</span><span class="n">flight</span><span class="p">[</span><span class="n">n</span><span class="p">,:])</span> \
                        <span class="o">*</span><span class="p">(</span><span class="n">stop_val</span> <span class="o">-</span> <span class="n">flight</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">stop_idx</span><span class="p">])</span> \
                        <span class="o">/</span><span class="p">(</span><span class="n">flight</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">stop_idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">flight</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">stop_idx</span><span class="p">])</span>

    <span class="n">flight</span> <span class="o">=</span> <span class="n">flight</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">,:]</span>
    <span class="n">flight</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">xout</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">xout</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">flight</span><span class="p">,</span><span class="n">state</span></div>


<span class="c1">#===========================================================================================================</span>
<div class="viewcode-block" id="standard_descent"><a class="viewcode-back" href="../../../../api/marilib.aircraft_model.operations.qs_mission.html#marilib.aircraft_model.operations.qs_mission.standard_descent">[docs]</a><span class="k">def</span> <span class="nf">standard_descent</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">altp0</span><span class="p">,</span><span class="n">vcas1</span><span class="p">,</span><span class="n">altp1</span><span class="p">,</span><span class="n">vcas2</span><span class="p">,</span><span class="n">mach</span><span class="p">,</span><span class="n">flight</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constant CAS climb :</span>
<span class="sd">    vcas1 from altp0 to altp1</span>
<span class="sd">    vcas2 from alpt1 to crossover altitude with iso mach</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Initialize climb flight</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="n">xout</span> <span class="o">=</span> <span class="n">flight</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">xout</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
    <span class="n">altp2</span> <span class="o">=</span> <span class="n">xout</span><span class="p">[</span><span class="n">xout_dict</span><span class="p">[</span><span class="s2">&quot;altp&quot;</span><span class="p">]]</span>

    <span class="n">altp_cross_over</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">cross_over_altp</span><span class="p">(</span><span class="n">vcas2</span><span class="p">,</span><span class="n">mach</span><span class="p">)</span>

    <span class="p">(</span><span class="n">MTO</span><span class="p">,</span><span class="n">MCN</span><span class="p">,</span><span class="n">MCL</span><span class="p">,</span><span class="n">MCR</span><span class="p">,</span><span class="n">FID</span><span class="p">)</span> <span class="o">=</span> <span class="n">aircraft</span><span class="o">.</span><span class="n">propulsion</span><span class="o">.</span><span class="n">rating_code</span>
    <span class="n">nei</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="c1"># Data filtering</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="k">if</span><span class="p">(</span><span class="n">vcas1</span><span class="o">&gt;</span><span class="n">vcas2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;iso_cas_climb, vcas2 must be higher or equal than vcas1&quot;</span><span class="p">)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">altp0</span><span class="o">&gt;</span><span class="n">altp1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;iso_cas_climb, altp1 must be higher than starting altitude&quot;</span><span class="p">)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">altp1</span><span class="o">&gt;</span><span class="n">altp2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;iso_cas_climb, altp2 must be higher than altp1&quot;</span><span class="p">)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">altp1</span><span class="o">&gt;</span><span class="n">altp_cross_over</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;iso_cas_climb, cross over altitude must be higher than altp1&quot;</span><span class="p">)</span>

    <span class="c1"># Constant mach descent segment</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mach</span><span class="p">,</span><span class="n">altp_cross_over</span><span class="p">])</span>
    <span class="n">dat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;fn&quot;</span><span class="p">,</span><span class="s2">&quot;fct_thrust(aircraft,state,rating,nei)&quot;</span><span class="p">]])</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;cz&quot;</span><span class="p">])</span>
    <span class="n">dof</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;vgnd&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
    <span class="n">cst</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;mach&quot;</span><span class="p">,</span><span class="s2">&quot;input[0]&quot;</span><span class="p">],[</span><span class="s2">&quot;mach_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">],[</span><span class="s2">&quot;path_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">]])</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;altp&quot;</span><span class="p">,</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span><span class="s2">&quot;input[1]&quot;</span><span class="p">])</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">30.</span>

    <span class="n">flight</span><span class="p">,</span><span class="n">state</span> <span class="o">=</span> <span class="n">flight_segment</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">FID</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="nb">input</span><span class="p">,</span><span class="n">dat</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="n">cst</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">flight</span><span class="p">)</span>

    <span class="c1"># First constant CAS descent segment</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">vcas2</span><span class="p">,</span><span class="n">altp1</span><span class="p">])</span>
    <span class="n">dat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;fn&quot;</span><span class="p">,</span><span class="s2">&quot;fct_thrust(aircraft,state,rating,nei)&quot;</span><span class="p">]])</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;cz&quot;</span><span class="p">])</span>
    <span class="n">dof</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;vgnd&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
    <span class="n">cst</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;vcas&quot;</span><span class="p">,</span><span class="s2">&quot;input[0]&quot;</span><span class="p">],[</span><span class="s2">&quot;vcas_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">],[</span><span class="s2">&quot;path_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">]])</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;altp&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="s2">&quot;input[1]&quot;</span><span class="p">])</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">30.</span>

    <span class="n">flight</span><span class="p">,</span><span class="n">state</span> <span class="o">=</span> <span class="n">flight_segment</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">FID</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="nb">input</span><span class="p">,</span><span class="n">dat</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="n">cst</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">flight</span><span class="p">)</span>

    <span class="c1"># Deceleration at constant altitude</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">altp1</span><span class="p">,</span><span class="n">vcas1</span><span class="p">])</span>
    <span class="n">dat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;fn&quot;</span><span class="p">,</span><span class="s2">&quot;fct_thrust(aircraft,state,rating,nei)&quot;</span><span class="p">]])</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;cz&quot;</span><span class="p">])</span>
    <span class="n">dof</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;zg&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
    <span class="n">cst</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;altp&quot;</span><span class="p">,</span><span class="s2">&quot;input[0]&quot;</span><span class="p">],[</span><span class="s2">&quot;altp_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">],[</span><span class="s2">&quot;path_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">]])</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;vcas&quot;</span><span class="p">,</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span><span class="s2">&quot;input[1]&quot;</span><span class="p">])</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">5.</span>

    <span class="n">flight</span><span class="p">,</span><span class="n">state</span> <span class="o">=</span> <span class="n">flight_segment</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">FID</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="nb">input</span><span class="p">,</span><span class="n">dat</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="n">cst</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">flight</span><span class="p">)</span>

    <span class="c1"># Second constant CAS descent segment</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">vcas1</span><span class="p">,</span><span class="n">altp0</span><span class="p">])</span>
    <span class="n">dat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;fn&quot;</span><span class="p">,</span><span class="s2">&quot;fct_thrust(aircraft,state,rating,nei)&quot;</span><span class="p">]])</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;cz&quot;</span><span class="p">])</span>
    <span class="n">dof</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;vgnd&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
    <span class="n">cst</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;vcas&quot;</span><span class="p">,</span><span class="s2">&quot;input[0]&quot;</span><span class="p">],[</span><span class="s2">&quot;vcas_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">],[</span><span class="s2">&quot;path_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">]])</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;altp&quot;</span><span class="p">,</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span><span class="s2">&quot;input[1]&quot;</span><span class="p">])</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">30.</span>

    <span class="n">flight</span><span class="p">,</span><span class="n">state</span> <span class="o">=</span> <span class="n">flight_segment</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">FID</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="nb">input</span><span class="p">,</span><span class="n">dat</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="n">cst</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">flight</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">flight</span><span class="p">,</span><span class="n">state</span></div>


<span class="c1">#===========================================================================================================</span>
<div class="viewcode-block" id="qs_mission"><a class="viewcode-back" href="../../../../api/marilib.aircraft_model.operations.qs_mission.html#marilib.aircraft_model.operations.qs_mission.qs_mission">[docs]</a><span class="k">def</span> <span class="nf">qs_mission</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">disa</span><span class="p">,</span><span class="n">tow</span><span class="p">,</span><span class="nb">range</span><span class="p">,</span><span class="n">heading</span><span class="p">,</span>
               <span class="n">altp0_clb</span><span class="p">,</span><span class="n">vcas1_clb</span><span class="p">,</span><span class="n">altp1_clb</span><span class="p">,</span><span class="n">vcas2_clb</span><span class="p">,</span><span class="n">altp2_clb</span><span class="p">,</span><span class="n">cruise_mach</span><span class="p">,</span>
               <span class="n">vcas2_dsc</span><span class="p">,</span><span class="n">altp1_dsc</span><span class="p">,</span><span class="n">vcas1_dsc</span><span class="p">,</span><span class="n">altp0_dsc</span><span class="p">,</span><span class="n">vz_mcr_min</span><span class="p">,</span><span class="n">vz_mcl_min</span><span class="p">):</span>

    <span class="p">(</span><span class="n">MTO</span><span class="p">,</span><span class="n">MCN</span><span class="p">,</span><span class="n">MCL</span><span class="p">,</span><span class="n">MCR</span><span class="p">,</span><span class="n">FID</span><span class="p">)</span> <span class="o">=</span> <span class="n">aircraft</span><span class="o">.</span><span class="n">propulsion</span><span class="o">.</span><span class="n">rating_code</span>
    <span class="n">nei</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="n">altp_cabin</span> <span class="o">=</span> <span class="n">cabin_virtual_altp</span><span class="p">()</span>

    <span class="n">t</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">xg</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">zg</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">altg_from_altp</span><span class="p">(</span><span class="n">altp0_clb</span><span class="p">,</span><span class="n">disa</span><span class="p">)</span>
    <span class="n">vgnd</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">vtas_from_vcas</span><span class="p">(</span><span class="n">altp0_clb</span><span class="p">,</span><span class="n">disa</span><span class="p">,</span><span class="n">vcas1_clb</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">t</span><span class="p">,</span><span class="n">tow</span><span class="p">,</span><span class="n">xg</span><span class="p">,</span><span class="n">zg</span><span class="p">,</span><span class="n">vgnd</span><span class="p">,</span><span class="n">path</span><span class="p">])</span>

    <span class="n">xout</span><span class="p">,</span><span class="n">state_d</span> <span class="o">=</span> <span class="n">state_dot</span><span class="p">(</span><span class="n">xin</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">MCL</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">aircraft</span><span class="p">)</span>

    <span class="n">flight</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">([[</span><span class="n">xout</span><span class="p">]])</span>

    <span class="n">flight</span><span class="p">,</span><span class="n">state</span> <span class="o">=</span> <span class="n">iso_cas_climb</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">vcas1_clb</span><span class="p">,</span><span class="n">altp1_clb</span><span class="p">,</span><span class="n">vcas2_clb</span><span class="p">,</span><span class="n">altp2_clb</span><span class="p">,</span><span class="n">cruise_mach</span><span class="p">,</span><span class="n">vz_mcl_min</span><span class="p">,</span><span class="n">flight</span><span class="p">)</span>


    <span class="n">stop</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;xg&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="nb">range</span><span class="p">)])</span>

    <span class="n">flight</span><span class="p">,</span><span class="n">state</span> <span class="o">=</span> <span class="n">level_flight</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">cruise_mach</span><span class="p">,</span><span class="n">vz_mcl_min</span><span class="p">,</span><span class="n">vz_mcr_min</span><span class="p">,</span><span class="n">heading</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="n">flight</span><span class="p">)</span>


    <span class="n">flight</span><span class="p">,</span><span class="n">state</span> <span class="o">=</span> <span class="n">standard_descent</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">altp0_dsc</span><span class="p">,</span><span class="n">vcas1_dsc</span><span class="p">,</span><span class="n">altp1_dsc</span><span class="p">,</span><span class="n">vcas2_dsc</span><span class="p">,</span><span class="n">cruise_mach</span><span class="p">,</span><span class="n">flight</span><span class="p">)</span></div>






<span class="c1">#===========================================================================================================</span>
<div class="viewcode-block" id="init_var"><a class="viewcode-back" href="../../../../api/marilib.aircraft_model.operations.qs_mission.html#marilib.aircraft_model.operations.qs_mission.init_var">[docs]</a><span class="k">def</span> <span class="nf">init_var</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">):</span>

    <span class="n">n_cmd</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">cmd</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_dof</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">dof</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">var</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">n_cmd</span><span class="o">+</span><span class="n">n_dof</span><span class="p">)</span>

    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cz&quot;</span><span class="p">:</span><span class="n">aircraft</span><span class="o">.</span><span class="n">aerodynamics</span><span class="o">.</span><span class="n">cz_cruise_lod_max</span><span class="p">,</span>
             <span class="s2">&quot;fn&quot;</span><span class="p">:</span><span class="n">aircraft</span><span class="o">.</span><span class="n">propulsion</span><span class="o">.</span><span class="n">mcl_thrust_ref</span><span class="p">}</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cmd</span><span class="p">):</span>
        <span class="n">var</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="n">cmd</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_dof</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dof</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;path&quot;</span><span class="p">):</span>
            <span class="n">var</span><span class="p">[</span><span class="n">n_cmd</span><span class="o">+</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span>     <span class="c1"># Special init for path variable</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">var</span><span class="p">[</span><span class="n">n_cmd</span><span class="o">+</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="n">state_dict</span><span class="p">[</span><span class="n">dof</span><span class="p">[</span><span class="n">i</span><span class="p">]]]</span>

    <span class="k">return</span> <span class="n">var</span></div>


<span class="c1">#===========================================================================================================</span>
<div class="viewcode-block" id="test_ceilings"><a class="viewcode-back" href="../../../../api/marilib.aircraft_model.operations.qs_mission.html#marilib.aircraft_model.operations.qs_mission.test_ceilings">[docs]</a><span class="k">def</span> <span class="nf">test_ceilings</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">mach</span><span class="p">,</span><span class="n">altp</span><span class="p">,</span><span class="n">state</span><span class="p">):</span>

    <span class="n">state_copy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

    <span class="p">(</span><span class="n">MTO</span><span class="p">,</span><span class="n">MCN</span><span class="p">,</span><span class="n">MCL</span><span class="p">,</span><span class="n">MCR</span><span class="p">,</span><span class="n">FID</span><span class="p">)</span> <span class="o">=</span> <span class="n">aircraft</span><span class="o">.</span><span class="n">propulsion</span><span class="o">.</span><span class="n">rating_code</span>

    <span class="nb">input</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">altp</span><span class="p">,</span><span class="n">mach</span><span class="p">])</span>
    <span class="n">dat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;fn&quot;</span><span class="p">,</span><span class="s2">&quot;fct_thrust(aircraft,state,rating,nei)&quot;</span><span class="p">]])</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;cz&quot;</span><span class="p">])</span>
    <span class="n">dof</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;zg&quot;</span><span class="p">,</span><span class="s2">&quot;vgnd&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
    <span class="n">cst</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;altp&quot;</span><span class="p">,</span><span class="s2">&quot;input[0]&quot;</span><span class="p">],[</span><span class="s2">&quot;mach&quot;</span><span class="p">,</span><span class="s2">&quot;input[1]&quot;</span><span class="p">],[</span><span class="s2">&quot;mach_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">],[</span><span class="s2">&quot;path_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">]])</span>

    <span class="n">var</span> <span class="o">=</span> <span class="n">init_var</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">)</span>

    <span class="n">xout</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">state_d</span> <span class="o">=</span> <span class="n">flight_point</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">MCR</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">state_copy</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="nb">input</span><span class="p">,</span><span class="n">dat</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="n">cst</span><span class="p">)</span>
    <span class="n">vz_mcr</span> <span class="o">=</span> <span class="n">xout</span><span class="p">[</span><span class="n">xout_dict</span><span class="p">[</span><span class="s2">&quot;vzair&quot;</span><span class="p">]]</span>

    <span class="n">var</span> <span class="o">=</span> <span class="n">init_var</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">)</span>

    <span class="n">xout</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">state_d</span> <span class="o">=</span> <span class="n">flight_point</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">MCL</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">state_copy</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="nb">input</span><span class="p">,</span><span class="n">dat</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="n">cst</span><span class="p">)</span>
    <span class="n">vz_mcl</span> <span class="o">=</span> <span class="n">xout</span><span class="p">[</span><span class="n">xout_dict</span><span class="p">[</span><span class="s2">&quot;vzair&quot;</span><span class="p">]]</span>

    <span class="k">return</span> <span class="n">vz_mcr</span><span class="p">,</span><span class="n">vz_mcl</span></div>


<span class="c1">#===========================================================================================================</span>
<div class="viewcode-block" id="test_air_range"><a class="viewcode-back" href="../../../../api/marilib.aircraft_model.operations.qs_mission.html#marilib.aircraft_model.operations.qs_mission.test_air_range">[docs]</a><span class="k">def</span> <span class="nf">test_air_range</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">rating</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">mach</span><span class="p">,</span><span class="n">altp</span><span class="p">,</span><span class="n">altp_up</span><span class="p">,</span><span class="n">state</span><span class="p">):</span>

    <span class="n">state_copy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

    <span class="n">dat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;cz&quot;</span><span class="p">,</span><span class="s2">&quot;fn&quot;</span><span class="p">])</span>
    <span class="n">dof</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;zg&quot;</span><span class="p">,</span><span class="s2">&quot;vgnd&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
    <span class="n">cst</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;altp&quot;</span><span class="p">,</span><span class="s2">&quot;input[0]&quot;</span><span class="p">],[</span><span class="s2">&quot;altp_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">],[</span><span class="s2">&quot;mach&quot;</span><span class="p">,</span><span class="s2">&quot;input[1]&quot;</span><span class="p">],[</span><span class="s2">&quot;mach_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">],[</span><span class="s2">&quot;path_d&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">]])</span>

    <span class="n">var</span> <span class="o">=</span> <span class="n">init_var</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">)</span>

    <span class="nb">input</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">altp</span><span class="p">,</span><span class="n">mach</span><span class="p">])</span>
    <span class="n">xout</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">state_d</span> <span class="o">=</span> <span class="n">flight_point</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">rating</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">state_copy</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="nb">input</span><span class="p">,</span><span class="n">dat</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="n">cst</span><span class="p">)</span>
    <span class="n">sar</span> <span class="o">=</span> <span class="o">-</span> <span class="n">state_d</span><span class="p">[</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;xg&quot;</span><span class="p">]]</span> <span class="o">/</span> <span class="n">state_d</span><span class="p">[</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;mass&quot;</span><span class="p">]]</span>

    <span class="n">var</span> <span class="o">=</span> <span class="n">init_var</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">)</span>

    <span class="nb">input</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">altp_up</span><span class="p">,</span><span class="n">mach</span><span class="p">])</span>
    <span class="n">xout_up</span><span class="p">,</span><span class="n">state_up</span><span class="p">,</span><span class="n">state_d_up</span> <span class="o">=</span> <span class="n">flight_point</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">rating</span><span class="p">,</span><span class="n">nei</span><span class="p">,</span><span class="n">state_copy</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="nb">input</span><span class="p">,</span><span class="n">dat</span><span class="p">,</span><span class="n">cmd</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="n">cst</span><span class="p">)</span>
    <span class="n">sar_up</span> <span class="o">=</span> <span class="o">-</span> <span class="n">state_d_up</span><span class="p">[</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;xg&quot;</span><span class="p">]]</span> <span class="o">/</span> <span class="n">state_d_up</span><span class="p">[</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;mass&quot;</span><span class="p">]]</span>

    <span class="k">return</span> <span class="n">sar</span><span class="p">,</span><span class="n">sar_up</span></div>

</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">MARILib 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../marilib.html" >marilib</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, T. Druot et al..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0.
    </div>
  </body>
</html>
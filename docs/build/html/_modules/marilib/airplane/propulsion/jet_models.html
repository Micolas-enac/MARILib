
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>marilib.airplane.propulsion.jet_models &#8212; MARILib 1.0.0 documentation</title>
    <link rel="stylesheet" href="../../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">MARILib 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../marilib.html" accesskey="U">marilib</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for marilib.airplane.propulsion.jet_models</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Thu Jan 24 23:22:21 2019</span>

<span class="sd">.. moduleauthor:: DRUOT Thierry : original Scilab implementation</span>
<span class="sd">.. moduleauthor:: ROCHES Pascal : portage to Python</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">marilib</span> <span class="k">import</span> <span class="n">numpy</span>
<span class="kn">from</span> <span class="nn">marilib</span> <span class="k">import</span> <span class="n">fsolve</span>
<span class="kn">from</span> <span class="nn">marilib.tools.math</span> <span class="k">import</span> <span class="n">lin_interp_1d</span>

<span class="kn">from</span> <span class="nn">marilib.earth</span> <span class="k">import</span> <span class="n">environment</span> <span class="k">as</span> <span class="n">earth</span>


<span class="c1"># ===========================================================================================================</span>
<div class="viewcode-block" id="efan_nacelle_design"><a class="viewcode-back" href="../../../../api/marilib.airplane.propulsion.jet_models.html#marilib.airplane.propulsion.jet_models.efan_nacelle_design">[docs]</a><span class="k">def</span> <span class="nf">efan_nacelle_design</span><span class="p">(</span><span class="n">this_nacelle</span><span class="p">,</span><span class="n">Pamb</span><span class="p">,</span><span class="n">Tamb</span><span class="p">,</span><span class="n">Mach</span><span class="p">,</span><span class="n">shaft_power</span><span class="p">,</span><span class="n">hub_width</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Electrofan nacelle design</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gam</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">heat_ratio</span><span class="p">()</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">gas_constant</span><span class="p">()</span>
    <span class="n">Cp</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">heat_constant</span><span class="p">(</span><span class="n">gam</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>

    <span class="n">Vsnd</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">sound_speed</span><span class="p">(</span><span class="n">Tamb</span><span class="p">)</span>
    <span class="n">Vair</span> <span class="o">=</span> <span class="n">Vsnd</span><span class="o">*</span><span class="n">Mach</span>

    <span class="c1"># Electrical nacelle geometry : e-nacelle diameter is size by cruise conditions</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="n">deltaV</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">Vair</span><span class="o">*</span><span class="p">(</span><span class="n">this_nacelle</span><span class="o">.</span><span class="n">efficiency_fan</span><span class="o">/</span><span class="n">this_nacelle</span><span class="o">.</span><span class="n">efficiency_prop</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span>      <span class="c1"># speed variation produced by the fan</span>

    <span class="n">PwInput</span> <span class="o">=</span> <span class="n">this_nacelle</span><span class="o">.</span><span class="n">efficiency_fan</span><span class="o">*</span><span class="n">shaft_power</span>     <span class="c1"># kinetic energy produced by the fan</span>

    <span class="n">Vinlet</span> <span class="o">=</span> <span class="n">Vair</span>
    <span class="n">Vjet</span> <span class="o">=</span> <span class="n">Vinlet</span> <span class="o">+</span> <span class="n">deltaV</span>

    <span class="n">q1</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">PwInput</span> <span class="o">/</span> <span class="p">(</span><span class="n">Vjet</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">Vinlet</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">MachInlet</span> <span class="o">=</span> <span class="n">Mach</span>     <span class="c1"># The inlet is in free stream</span>

    <span class="n">Ptot</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">total_pressure</span><span class="p">(</span><span class="n">Pamb</span><span class="p">,</span><span class="n">MachInlet</span><span class="p">)</span>        <span class="c1"># Stagnation pressure at inlet position</span>

    <span class="n">Ttot</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">total_temperature</span><span class="p">(</span><span class="n">Tamb</span><span class="p">,</span><span class="n">MachInlet</span><span class="p">)</span>     <span class="c1"># Stagnation temperature at inlet position</span>

    <span class="n">MachFan</span> <span class="o">=</span> <span class="mf">0.5</span>       <span class="c1"># required Mach number at fan position</span>

    <span class="n">CQoA1</span> <span class="o">=</span> <span class="n">corrected_air_flow</span><span class="p">(</span><span class="n">Ptot</span><span class="p">,</span><span class="n">Ttot</span><span class="p">,</span><span class="n">MachFan</span><span class="p">)</span>        <span class="c1"># Corrected air flow per area at fan position</span>

    <span class="n">eFanArea</span> <span class="o">=</span> <span class="n">q1</span><span class="o">/</span><span class="n">CQoA1</span>     <span class="c1"># Fan area around the hub</span>

    <span class="n">fan_width</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">hub_width</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">eFanArea</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>        <span class="c1"># Fan diameter</span>

    <span class="n">TtotJet</span> <span class="o">=</span> <span class="n">Ttot</span> <span class="o">+</span> <span class="n">shaft_power</span><span class="o">/</span><span class="p">(</span><span class="n">q1</span><span class="o">*</span><span class="n">Cp</span><span class="p">)</span>        <span class="c1"># Stagnation pressure increases due to introduced work</span>

    <span class="n">Tstat</span> <span class="o">=</span> <span class="n">TtotJet</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Vjet</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">Cp</span>        <span class="c1"># static temperature</span>

    <span class="n">VsndJet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gam</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">Tstat</span><span class="p">)</span> <span class="c1"># Sound velocity at nozzle exhaust</span>

    <span class="n">MachJet</span> <span class="o">=</span> <span class="n">Vjet</span><span class="o">/</span><span class="n">VsndJet</span> <span class="c1"># Mach number at nozzle output</span>

    <span class="n">PtotJet</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">total_pressure</span><span class="p">(</span><span class="n">Pamb</span><span class="p">,</span><span class="n">MachJet</span><span class="p">)</span>       <span class="c1"># total pressure at nozzle exhaust (P = Pamb)</span>

    <span class="n">CQoA2</span> <span class="o">=</span> <span class="n">corrected_air_flow</span><span class="p">(</span><span class="n">PtotJet</span><span class="p">,</span><span class="n">TtotJet</span><span class="p">,</span><span class="n">MachJet</span><span class="p">)</span>     <span class="c1"># Corrected air flow per area at nozzle output</span>

    <span class="n">nozzle_area</span> <span class="o">=</span> <span class="n">q1</span><span class="o">/</span><span class="n">CQoA2</span>        <span class="c1"># Fan area around the hub</span>

    <span class="n">nozzle_width</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">nozzle_area</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>       <span class="c1"># Nozzle diameter</span>

    <span class="n">this_nacelle</span><span class="o">.</span><span class="n">hub_width</span> <span class="o">=</span> <span class="n">hub_width</span>

    <span class="n">this_nacelle</span><span class="o">.</span><span class="n">fan_width</span> <span class="o">=</span> <span class="n">fan_width</span>

    <span class="n">this_nacelle</span><span class="o">.</span><span class="n">nozzle_width</span> <span class="o">=</span> <span class="n">nozzle_width</span>

    <span class="n">this_nacelle</span><span class="o">.</span><span class="n">nozzle_area</span> <span class="o">=</span> <span class="n">nozzle_area</span>

    <span class="n">this_nacelle</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mf">1.20</span><span class="o">*</span><span class="n">fan_width</span>      <span class="c1"># Surrounding structure</span>

    <span class="n">this_nacelle</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="mf">1.50</span><span class="o">*</span><span class="n">this_nacelle</span><span class="o">.</span><span class="n">width</span>

    <span class="c1"># Total wetted area of main nacelles</span>
    <span class="n">this_nacelle</span><span class="o">.</span><span class="n">net_wetted_area</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">this_nacelle</span><span class="o">.</span><span class="n">width</span><span class="o">*</span><span class="n">this_nacelle</span><span class="o">.</span><span class="n">length</span><span class="o">*</span><span class="n">this_nacelle</span><span class="o">.</span><span class="n">n_engine</span>

    <span class="k">return</span></div>


<span class="c1"># ===========================================================================================================</span>
<div class="viewcode-block" id="resize_boundary_layer"><a class="viewcode-back" href="../../../../api/marilib.airplane.propulsion.jet_models.html#marilib.airplane.propulsion.jet_models.resize_boundary_layer">[docs]</a><span class="k">def</span> <span class="nf">resize_boundary_layer</span><span class="p">(</span><span class="n">body_width</span><span class="p">,</span><span class="n">hub_width</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the relation between d0 and d1:</span>

<span class="sd">    * d0 : boundary layer thickness around a tube of constant diameter</span>
<span class="sd">    * d1 : boundary layer thickness around a the tapered part of the tube</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">r0</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">body_width</span>   <span class="c1"># Radius of the fuselage, supposed constant</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">hub_width</span>    <span class="c1"># Radius of the hub of the efan nacelle</span>

    <span class="c1">#===========================================================================================================</span>
    <span class="k">def</span> <span class="nf">fct_specific_flows</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">r1</span><span class="p">,</span><span class="n">d0</span><span class="p">,</span><span class="n">r0</span><span class="p">):</span>
        <span class="p">(</span><span class="n">q0s0</span><span class="p">,</span><span class="n">q1s0</span><span class="p">,</span><span class="n">q2s0</span><span class="p">,</span><span class="n">v1s0</span><span class="p">,</span><span class="n">dvs0</span><span class="p">)</span> <span class="o">=</span> <span class="n">specific_air_flows</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span><span class="n">d0</span><span class="p">,</span><span class="n">d0</span><span class="p">)</span>
        <span class="p">(</span><span class="n">q0s1</span><span class="p">,</span><span class="n">q1s1</span><span class="p">,</span><span class="n">q2s1</span><span class="p">,</span><span class="n">v1s1</span><span class="p">,</span><span class="n">dvs1</span><span class="p">)</span> <span class="o">=</span> <span class="n">specific_air_flows</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">d1</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">q2s0</span> <span class="o">-</span> <span class="n">q2s1</span>
        <span class="k">return</span> <span class="n">y</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>

    <span class="n">n</span> <span class="o">=</span> <span class="mi">25</span>
    <span class="n">yVein</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">1.50</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>

    <span class="n">body_bnd_layer</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">fct1s</span> <span class="o">=</span> <span class="p">(</span><span class="n">r1</span><span class="p">,</span><span class="n">yVein</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">r0</span><span class="p">)</span>
        <span class="c1"># computation of d1 theoretical thickness of the boundary layer that passes the same air flow around the hub</span>
        <span class="n">body_bnd_layer</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">yVein</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">body_bnd_layer</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">fct_specific_flows</span><span class="p">,</span><span class="n">yVein</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">fct1s</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">body_bnd_layer</span></div>


<span class="c1"># ===========================================================================================================</span>
<div class="viewcode-block" id="rear_nacelle_design"><a class="viewcode-back" href="../../../../api/marilib.airplane.propulsion.jet_models.html#marilib.airplane.propulsion.jet_models.rear_nacelle_design">[docs]</a><span class="k">def</span> <span class="nf">rear_nacelle_design</span><span class="p">(</span><span class="n">this_nacelle</span><span class="p">,</span><span class="n">Pamb</span><span class="p">,</span><span class="n">Tamb</span><span class="p">,</span><span class="n">Mach</span><span class="p">,</span><span class="n">shaft_power</span><span class="p">,</span><span class="n">hub_width</span><span class="p">,</span><span class="n">body_length</span><span class="p">,</span><span class="n">body_width</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;BLI nacelle design</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gam</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">heat_ratio</span><span class="p">()</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">gas_constant</span><span class="p">()</span>
    <span class="n">Cp</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">heat_constant</span><span class="p">(</span><span class="n">gam</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>

    <span class="p">(</span><span class="n">rho</span><span class="p">,</span><span class="n">sig</span><span class="p">)</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">air_density</span><span class="p">(</span><span class="n">Pamb</span><span class="p">,</span><span class="n">Tamb</span><span class="p">)</span>
    <span class="n">Vsnd</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">sound_speed</span><span class="p">(</span><span class="n">Tamb</span><span class="p">)</span>
    <span class="n">Re</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">reynolds_number</span><span class="p">(</span><span class="n">Pamb</span><span class="p">,</span><span class="n">Tamb</span><span class="p">,</span><span class="n">Mach</span><span class="p">)</span>
    <span class="n">Vair</span> <span class="o">=</span> <span class="n">Vsnd</span><span class="o">*</span><span class="n">Mach</span>

    <span class="c1"># Precalculation of the relation between d0 and d1</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>

    <span class="n">body_bnd_layer</span> <span class="o">=</span> <span class="n">resize_boundary_layer</span><span class="p">(</span><span class="n">body_width</span><span class="p">,</span><span class="n">hub_width</span><span class="p">)</span>

    <span class="c1"># Electrical nacelle geometry : e-nacelle diameter is size by cruise conditions</span>
    <span class="c1">#-----------------------------------------------------------------------------------------------------------</span>
    <span class="n">r0</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">body_width</span>     <span class="c1"># Radius of the fuselage, supposed constant</span>
    <span class="n">d0</span> <span class="o">=</span> <span class="n">boundary_layer</span><span class="p">(</span><span class="n">Re</span><span class="p">,</span><span class="n">body_length</span><span class="p">)</span>     <span class="c1"># theoritical thickness of the boundary layer without taking account of fuselage tapering</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">hub_width</span>        <span class="c1"># Radius of the hub of the efan nacelle</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">lin_interp_1d</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span><span class="n">body_bnd_layer</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">body_bnd_layer</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>       <span class="c1"># Thickness of the BL around the hub</span>

    <span class="n">deltaV</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">Vair</span><span class="o">*</span><span class="p">(</span><span class="n">this_nacelle</span><span class="o">.</span><span class="n">efficiency_fan</span><span class="o">/</span><span class="n">this_nacelle</span><span class="o">.</span><span class="n">efficiency_prop</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span>      <span class="c1"># speed variation produced by the fan</span>

    <span class="n">PwInput</span> <span class="o">=</span> <span class="n">this_nacelle</span><span class="o">.</span><span class="n">efficiency_fan</span><span class="o">*</span><span class="n">shaft_power</span>     <span class="c1"># kinetic energy produced by the fan</span>

    <span class="c1"># ===========================================================================================================</span>
    <span class="k">def</span> <span class="nf">fct_power_1</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">PwInput</span><span class="p">,</span><span class="n">deltaV</span><span class="p">,</span><span class="n">rho</span><span class="p">,</span><span class="n">Vair</span><span class="p">,</span><span class="n">r1</span><span class="p">,</span><span class="n">d1</span><span class="p">):</span>
        <span class="p">(</span><span class="n">q0</span><span class="p">,</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">dVbli</span><span class="p">)</span> <span class="o">=</span> <span class="n">air_flows</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span><span class="n">Vair</span><span class="p">,</span><span class="n">r1</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="n">Vinlet</span> <span class="o">=</span> <span class="n">Vair</span> <span class="o">-</span> <span class="n">dVbli</span>
        <span class="n">Vjet</span> <span class="o">=</span> <span class="n">Vinlet</span> <span class="o">+</span> <span class="n">deltaV</span>
        <span class="n">Pw</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">q1</span><span class="o">*</span><span class="p">(</span><span class="n">Vjet</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">Vinlet</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">PwInput</span> <span class="o">-</span> <span class="n">Pw</span>
        <span class="k">return</span> <span class="n">y</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="n">fct_arg</span> <span class="o">=</span> <span class="p">(</span><span class="n">PwInput</span><span class="p">,</span><span class="n">deltaV</span><span class="p">,</span><span class="n">rho</span><span class="p">,</span><span class="n">Vair</span><span class="p">,</span><span class="n">r1</span><span class="p">,</span><span class="n">d1</span><span class="p">)</span>

    <span class="c1"># Computation of y1 : thickness of the vein swallowed by the inlet</span>
    <span class="n">output_dict</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">fct_power_1</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">d1</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">fct_arg</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">y1</span> <span class="o">=</span> <span class="n">output_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="p">(</span><span class="n">q0</span><span class="p">,</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">dVbli</span><span class="p">)</span> <span class="o">=</span> <span class="n">air_flows</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span><span class="n">Vair</span><span class="p">,</span><span class="n">r1</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">y1</span><span class="p">)</span>

    <span class="n">MachInlet</span> <span class="o">=</span> <span class="n">v1</span><span class="o">/</span><span class="n">Vsnd</span>     <span class="c1"># Mean Mach number at inlet position</span>

    <span class="n">Ptot</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">total_pressure</span><span class="p">(</span><span class="n">Pamb</span><span class="p">,</span><span class="n">MachInlet</span><span class="p">)</span>        <span class="c1"># Stagnation pressure at inlet position</span>

    <span class="n">Ttot</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">total_temperature</span><span class="p">(</span><span class="n">Tamb</span><span class="p">,</span><span class="n">MachInlet</span><span class="p">)</span>     <span class="c1"># Stagnation temperature at inlet position</span>

    <span class="n">MachFan</span> <span class="o">=</span> <span class="mf">0.5</span>       <span class="c1"># required Mach number at fan position</span>

    <span class="n">CQoA1</span> <span class="o">=</span> <span class="n">corrected_air_flow</span><span class="p">(</span><span class="n">Ptot</span><span class="p">,</span><span class="n">Ttot</span><span class="p">,</span><span class="n">MachFan</span><span class="p">)</span>        <span class="c1"># Corrected air flow per area at fan position</span>

    <span class="n">eFanArea</span> <span class="o">=</span> <span class="n">q1</span><span class="o">/</span><span class="n">CQoA1</span>     <span class="c1"># Fan area around the hub</span>

    <span class="n">fan_width</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">hub_width</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">eFanArea</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>        <span class="c1"># Fan diameter</span>

    <span class="n">Vjet</span> <span class="o">=</span> <span class="n">v1</span> <span class="o">+</span> <span class="n">deltaV</span>      <span class="c1"># Jet velocity</span>

    <span class="n">TtotJet</span> <span class="o">=</span> <span class="n">Ttot</span> <span class="o">+</span> <span class="n">shaft_power</span><span class="o">/</span><span class="p">(</span><span class="n">q1</span><span class="o">*</span><span class="n">Cp</span><span class="p">)</span>        <span class="c1"># Stagnation pressure increases due to introduced work</span>

    <span class="n">Tstat</span> <span class="o">=</span> <span class="n">TtotJet</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Vjet</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">Cp</span>        <span class="c1"># static temperature</span>

    <span class="n">VsndJet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gam</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">Tstat</span><span class="p">)</span> <span class="c1"># Sound velocity at nozzle exhaust</span>

    <span class="n">MachJet</span> <span class="o">=</span> <span class="n">Vjet</span><span class="o">/</span><span class="n">VsndJet</span> <span class="c1"># Mach number at nozzle output</span>

    <span class="n">PtotJet</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">total_pressure</span><span class="p">(</span><span class="n">Pamb</span><span class="p">,</span><span class="n">MachJet</span><span class="p">)</span>       <span class="c1"># total pressure at nozzle exhaust (P = Pamb)</span>

    <span class="n">CQoA2</span> <span class="o">=</span> <span class="n">corrected_air_flow</span><span class="p">(</span><span class="n">PtotJet</span><span class="p">,</span><span class="n">TtotJet</span><span class="p">,</span><span class="n">MachJet</span><span class="p">)</span>     <span class="c1"># Corrected air flow per area at nozzle output</span>

    <span class="n">nozzle_area</span> <span class="o">=</span> <span class="n">q1</span><span class="o">/</span><span class="n">CQoA2</span>        <span class="c1"># Fan area around the hub</span>

    <span class="n">nozzle_width</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">nozzle_area</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>       <span class="c1"># Nozzle diameter</span>

    <span class="n">this_nacelle</span><span class="o">.</span><span class="n">hub_width</span> <span class="o">=</span> <span class="n">hub_width</span>

    <span class="n">this_nacelle</span><span class="o">.</span><span class="n">fan_width</span> <span class="o">=</span> <span class="n">fan_width</span>

    <span class="n">this_nacelle</span><span class="o">.</span><span class="n">nozzle_width</span> <span class="o">=</span> <span class="n">nozzle_width</span>

    <span class="n">this_nacelle</span><span class="o">.</span><span class="n">nozzle_area</span> <span class="o">=</span> <span class="n">nozzle_area</span>

    <span class="n">this_nacelle</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mf">1.20</span><span class="o">*</span><span class="n">fan_width</span>      <span class="c1"># Surrounding structure</span>

    <span class="n">this_nacelle</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="mf">1.50</span><span class="o">*</span><span class="n">this_nacelle</span><span class="o">.</span><span class="n">width</span>

    <span class="n">this_nacelle</span><span class="o">.</span><span class="n">net_wetted_area</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">this_nacelle</span><span class="o">.</span><span class="n">width</span><span class="o">*</span><span class="n">this_nacelle</span><span class="o">.</span><span class="n">length</span>        <span class="c1"># Nacelle wetted area</span>

    <span class="n">this_nacelle</span><span class="o">.</span><span class="n">bnd_layer</span> <span class="o">=</span> <span class="n">body_bnd_layer</span>

    <span class="n">this_nacelle</span><span class="o">.</span><span class="n">body_length</span> <span class="o">=</span> <span class="n">body_length</span>

    <span class="k">return</span></div>


<span class="c1"># ===========================================================================================================</span>
<div class="viewcode-block" id="fan_thrust_with_bli"><a class="viewcode-back" href="../../../../api/marilib.airplane.propulsion.jet_models.html#marilib.airplane.propulsion.jet_models.fan_thrust_with_bli">[docs]</a><span class="k">def</span> <span class="nf">fan_thrust_with_bli</span><span class="p">(</span><span class="n">nacelle</span><span class="p">,</span><span class="n">Pamb</span><span class="p">,</span><span class="n">Tamb</span><span class="p">,</span><span class="n">Mach</span><span class="p">,</span><span class="n">PwShaft</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the thrust of a fan of a given geometry swallowing</span>
<span class="sd">    the boundary layer (BL) of a body of a given geometry</span>
<span class="sd">    The amount of swallowed BL depends on the given shaft power and flying</span>
<span class="sd">    conditions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gam</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">heat_ratio</span><span class="p">()</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">gas_constant</span><span class="p">()</span>
    <span class="n">Cp</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">heat_constant</span><span class="p">(</span><span class="n">gam</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>

    <span class="c1"># ===========================================================================================================</span>
    <span class="k">def</span> <span class="nf">fct_power_bli</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">PwShaft</span><span class="p">,</span><span class="n">Pamb</span><span class="p">,</span><span class="n">rho</span><span class="p">,</span><span class="n">Ttot</span><span class="p">,</span><span class="n">Vair</span><span class="p">,</span><span class="n">r1</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">nozzle_area</span><span class="p">):</span>

        <span class="p">(</span><span class="n">q0</span><span class="p">,</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">,</span><span class="n">Vinlet</span><span class="p">,</span><span class="n">dVbli</span><span class="p">)</span> <span class="o">=</span> <span class="n">air_flows</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span><span class="n">Vair</span><span class="p">,</span><span class="n">r1</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="n">PwInput</span> <span class="o">=</span> <span class="n">nacelle</span><span class="o">.</span><span class="n">efficiency_fan</span> <span class="o">*</span> <span class="n">PwShaft</span>
        <span class="n">Vjet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">PwInput</span><span class="o">/</span><span class="n">q1</span> <span class="o">+</span> <span class="n">Vinlet</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">TtotJet</span> <span class="o">=</span> <span class="n">Ttot</span> <span class="o">+</span> <span class="n">PwShaft</span><span class="o">/</span><span class="p">(</span><span class="n">q1</span><span class="o">*</span><span class="n">Cp</span><span class="p">)</span>        <span class="c1"># Stagnation temperature increases due to introduced work</span>
        <span class="n">Tstat</span> <span class="o">=</span> <span class="n">TtotJet</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Vjet</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">Cp</span>        <span class="c1"># Static temperature</span>
        <span class="n">VsndJet</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">sound_speed</span><span class="p">(</span><span class="n">Tstat</span><span class="p">)</span>     <span class="c1"># Sound speed at nozzle exhaust</span>
        <span class="n">MachJet</span> <span class="o">=</span> <span class="n">Vjet</span><span class="o">/</span><span class="n">VsndJet</span>                  <span class="c1"># Mach number at nozzle output</span>
        <span class="n">PtotJet</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">total_pressure</span><span class="p">(</span><span class="n">Pamb</span><span class="p">,</span><span class="n">MachJet</span><span class="p">)</span>       <span class="c1"># total pressure at nozzle exhaust (P = Pamb) supposing adapted nozzle</span>
        <span class="n">CQoA1</span> <span class="o">=</span> <span class="n">corrected_air_flow</span><span class="p">(</span><span class="n">PtotJet</span><span class="p">,</span><span class="n">TtotJet</span><span class="p">,</span><span class="n">MachJet</span><span class="p">)</span>    <span class="c1"># Corrected air flow per area at nozzle position</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">CQoA1</span><span class="o">*</span><span class="n">nozzle_area</span>

        <span class="n">y</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">-</span> <span class="n">q</span>

        <span class="k">return</span> <span class="n">y</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="n">nozzle_area</span> <span class="o">=</span> <span class="n">nacelle</span><span class="o">.</span><span class="n">nozzle_area</span>
    <span class="n">bnd_layer</span> <span class="o">=</span> <span class="n">nacelle</span><span class="o">.</span><span class="n">bnd_layer</span>

    <span class="n">Re</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">reynolds_number</span><span class="p">(</span><span class="n">Pamb</span><span class="p">,</span><span class="n">Tamb</span><span class="p">,</span><span class="n">Mach</span><span class="p">)</span>

    <span class="n">d0</span> <span class="o">=</span> <span class="n">boundary_layer</span><span class="p">(</span><span class="n">Re</span><span class="p">,</span><span class="n">nacelle</span><span class="o">.</span><span class="n">body_length</span><span class="p">)</span>      <span class="c1"># theorical thickness of the boundary layer without taking account of fuselage tapering</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">nacelle</span><span class="o">.</span><span class="n">hub_width</span>      <span class="c1"># Radius of the hub of the eFan nacelle</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">lin_interp_1d</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span><span class="n">bnd_layer</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">bnd_layer</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>     <span class="c1"># Using the precomputed relation</span>

    <span class="n">Ttot</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">total_temperature</span><span class="p">(</span><span class="n">Tamb</span><span class="p">,</span><span class="n">Mach</span><span class="p">)</span>      <span class="c1"># Stagnation temperature at inlet position</span>
    <span class="n">rho</span><span class="p">,</span><span class="n">sig</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">air_density</span><span class="p">(</span><span class="n">Pamb</span><span class="p">,</span><span class="n">Tamb</span><span class="p">)</span>
    <span class="n">Vsnd</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">sound_speed</span><span class="p">(</span><span class="n">Tamb</span><span class="p">)</span>
    <span class="n">Vair</span> <span class="o">=</span> <span class="n">Vsnd</span><span class="o">*</span><span class="n">Mach</span>

    <span class="n">fct_arg</span> <span class="o">=</span> <span class="p">(</span><span class="n">PwShaft</span><span class="p">,</span><span class="n">Pamb</span><span class="p">,</span><span class="n">rho</span><span class="p">,</span><span class="n">Ttot</span><span class="p">,</span><span class="n">Vair</span><span class="p">,</span><span class="n">r1</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">nozzle_area</span><span class="p">)</span>

    <span class="c1"># Computation of y1 : thikness of the vein swallowed by the inlet</span>
    <span class="n">output_dict</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">fct_power_bli</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="mf">0.50</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">fct_arg</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">output_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">output_dict</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Convergence problem&quot;</span><span class="p">)</span>

    <span class="p">(</span><span class="n">q0</span><span class="p">,</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">,</span><span class="n">Vinlet</span><span class="p">,</span><span class="n">dVbli</span><span class="p">)</span> <span class="o">=</span> <span class="n">air_flows</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span><span class="n">Vair</span><span class="p">,</span><span class="n">r1</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="n">PwInput</span> <span class="o">=</span> <span class="n">nacelle</span><span class="o">.</span><span class="n">efficiency_fan</span> <span class="o">*</span> <span class="n">PwShaft</span>
    <span class="n">Vjet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">PwInput</span><span class="o">/</span><span class="n">q1</span> <span class="o">+</span> <span class="n">Vinlet</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">eFn</span> <span class="o">=</span> <span class="n">q1</span><span class="o">*</span><span class="p">(</span><span class="n">Vjet</span> <span class="o">-</span> <span class="n">Vinlet</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">eFn</span><span class="p">,</span><span class="n">q1</span><span class="p">,</span><span class="n">dVbli</span><span class="p">)</span></div>


<span class="c1"># ===========================================================================================================</span>
<div class="viewcode-block" id="fan_thrust"><a class="viewcode-back" href="../../../../api/marilib.airplane.propulsion.jet_models.html#marilib.airplane.propulsion.jet_models.fan_thrust">[docs]</a><span class="k">def</span> <span class="nf">fan_thrust</span><span class="p">(</span><span class="n">nacelle</span><span class="p">,</span><span class="n">Pamb</span><span class="p">,</span><span class="n">Tamb</span><span class="p">,</span><span class="n">Mach</span><span class="p">,</span><span class="n">PwShaft</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the thrust of a fan of given geometry swallowing free air stream</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gam</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">heat_ratio</span><span class="p">()</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">gas_constant</span><span class="p">()</span>
    <span class="n">Cp</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">heat_constant</span><span class="p">(</span><span class="n">gam</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>

    <span class="c1"># ===========================================================================================================</span>
    <span class="k">def</span> <span class="nf">fct_power</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">PwShaft</span><span class="p">,</span><span class="n">Pamb</span><span class="p">,</span><span class="n">Ttot</span><span class="p">,</span><span class="n">Vair</span><span class="p">,</span><span class="n">NozzleArea</span><span class="p">):</span>

        <span class="n">Vinlet</span> <span class="o">=</span> <span class="n">Vair</span>
        <span class="n">PwInput</span> <span class="o">=</span> <span class="n">nacelle</span><span class="o">.</span><span class="n">efficiency_fan</span><span class="o">*</span><span class="n">PwShaft</span>
        <span class="n">Vjet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">PwInput</span><span class="o">/</span><span class="n">q</span> <span class="o">+</span> <span class="n">Vinlet</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>         <span class="c1"># Supposing isentropic compression</span>
        <span class="n">TtotJet</span> <span class="o">=</span> <span class="n">Ttot</span> <span class="o">+</span> <span class="n">PwShaft</span><span class="o">/</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">Cp</span><span class="p">)</span>        <span class="c1"># Stagnation temperature increases due to introduced work</span>
        <span class="n">TstatJet</span> <span class="o">=</span> <span class="n">TtotJet</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Vjet</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">Cp</span>        <span class="c1"># Static temperature</span>
        <span class="n">VsndJet</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">sound_speed</span><span class="p">(</span><span class="n">TstatJet</span><span class="p">)</span>     <span class="c1"># Sound speed at nozzle exhaust</span>
        <span class="n">MachJet</span> <span class="o">=</span> <span class="n">Vjet</span><span class="o">/</span><span class="n">VsndJet</span>                  <span class="c1"># Mach number at nozzle output</span>
        <span class="n">PtotJet</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">total_pressure</span><span class="p">(</span><span class="n">Pamb</span><span class="p">,</span><span class="n">MachJet</span><span class="p">)</span>       <span class="c1"># total pressure at nozzle exhaust (P = Pamb)</span>
        <span class="n">CQoA1</span> <span class="o">=</span> <span class="n">corrected_air_flow</span><span class="p">(</span><span class="n">PtotJet</span><span class="p">,</span><span class="n">TtotJet</span><span class="p">,</span><span class="n">MachJet</span><span class="p">)</span>       <span class="c1"># Corrected air flow per area at fan position</span>
        <span class="n">q0</span> <span class="o">=</span> <span class="n">CQoA1</span><span class="o">*</span><span class="n">NozzleArea</span>

        <span class="n">y</span> <span class="o">=</span> <span class="n">q0</span> <span class="o">-</span> <span class="n">q</span>

        <span class="k">return</span> <span class="n">y</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="n">NozzleArea</span> <span class="o">=</span> <span class="n">nacelle</span><span class="o">.</span><span class="n">nozzle_area</span>
    <span class="n">FanWidth</span> <span class="o">=</span> <span class="n">nacelle</span><span class="o">.</span><span class="n">fan_width</span>

    <span class="n">Ptot</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">total_pressure</span><span class="p">(</span><span class="n">Pamb</span><span class="p">,</span><span class="n">Mach</span><span class="p">)</span>        <span class="c1"># Total pressure at inlet position</span>
    <span class="n">Ttot</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">total_temperature</span><span class="p">(</span><span class="n">Tamb</span><span class="p">,</span><span class="n">Mach</span><span class="p">)</span>     <span class="c1"># Total temperature at inlet position</span>

    <span class="n">Vsnd</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">sound_speed</span><span class="p">(</span><span class="n">Tamb</span><span class="p">)</span>
    <span class="n">Vair</span> <span class="o">=</span> <span class="n">Vsnd</span><span class="o">*</span><span class="n">Mach</span>

    <span class="n">fct_arg</span> <span class="o">=</span> <span class="p">(</span><span class="n">PwShaft</span><span class="p">,</span><span class="n">Pamb</span><span class="p">,</span><span class="n">Ttot</span><span class="p">,</span><span class="n">Vair</span><span class="p">,</span><span class="n">NozzleArea</span><span class="p">)</span>

    <span class="n">CQoA0</span> <span class="o">=</span> <span class="n">corrected_air_flow</span><span class="p">(</span><span class="n">Ptot</span><span class="p">,</span><span class="n">Ttot</span><span class="p">,</span><span class="n">Mach</span><span class="p">)</span>       <span class="c1"># Corrected air flow per area at fan position</span>
    <span class="n">q0init</span> <span class="o">=</span> <span class="n">CQoA0</span><span class="o">*</span><span class="p">(</span><span class="mf">0.25</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">FanWidth</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Computation of the air flow swallowed by the inlet</span>
    <span class="n">output_dict</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">fct_power</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">q0init</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">fct_arg</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">q0</span> <span class="o">=</span> <span class="n">output_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">output_dict</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Convergence problem&quot;</span><span class="p">)</span>

    <span class="n">Vinlet</span> <span class="o">=</span> <span class="n">Vair</span>
    <span class="n">PwInput</span> <span class="o">=</span> <span class="n">nacelle</span><span class="o">.</span><span class="n">efficiency_fan</span><span class="o">*</span><span class="n">PwShaft</span>
    <span class="n">Vjet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">PwInput</span><span class="o">/</span><span class="n">q0</span> <span class="o">+</span> <span class="n">Vinlet</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">eFn</span> <span class="o">=</span> <span class="n">q0</span><span class="o">*</span><span class="p">(</span><span class="n">Vjet</span> <span class="o">-</span> <span class="n">Vinlet</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">eFn</span><span class="p">,</span><span class="n">q0</span><span class="p">)</span></div>


<span class="c1"># ===========================================================================================================</span>
<div class="viewcode-block" id="corrected_air_flow"><a class="viewcode-back" href="../../../../api/marilib.airplane.propulsion.jet_models.html#marilib.airplane.propulsion.jet_models.corrected_air_flow">[docs]</a><span class="k">def</span> <span class="nf">corrected_air_flow</span><span class="p">(</span><span class="n">Ptot</span><span class="p">,</span><span class="n">Ttot</span><span class="p">,</span><span class="n">Mach</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the corrected air flow per square meter</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">R</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">gas_constant</span><span class="p">()</span>
    <span class="n">gam</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">heat_ratio</span><span class="p">()</span>

    <span class="n">f_M</span> <span class="o">=</span> <span class="n">Mach</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gam</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Mach</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">gam</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">gam</span><span class="o">-</span><span class="mf">1.</span><span class="p">)))</span>

    <span class="n">CQoA</span> <span class="o">=</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gam</span><span class="o">/</span><span class="n">R</span><span class="p">)</span><span class="o">*</span><span class="n">Ptot</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Ttot</span><span class="p">))</span><span class="o">*</span><span class="n">f_M</span>

    <span class="k">return</span> <span class="n">CQoA</span></div>


<span class="c1"># ===========================================================================================================</span>
<div class="viewcode-block" id="air_flows"><a class="viewcode-back" href="../../../../api/marilib.airplane.propulsion.jet_models.html#marilib.airplane.propulsion.jet_models.air_flows">[docs]</a><span class="k">def</span> <span class="nf">air_flows</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span><span class="n">v_air</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Air flows and speeds at rear end of a cylinder of radius rear_radius mouving at v_air in the direction of its axes</span>
<span class="sd">    y is the elevation upon the surface of the cylinder : 0 &lt; y &lt; inf</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># exponent in the formula of the speed profile inside a turbulent BL of thickness bly : Vy/Vair = (y/d)**(1/7)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">7.</span>

    <span class="c1"># Cumulated air flow at y_elev, without BL</span>
    <span class="n">q0</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">v_air</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">ym</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>

    <span class="c1"># Cumulated air flow at y_elev, with BL</span>
    <span class="n">q1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">v_air</span><span class="p">)</span><span class="o">*</span><span class="n">d</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">ym</span><span class="o">/</span><span class="n">d</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">ym</span><span class="o">/</span><span class="n">d</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">y</span><span class="o">&gt;</span><span class="n">d</span><span class="p">):</span>
        <span class="c1"># Add to Q1 the air flow outside the BL</span>
        <span class="n">q1</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">+</span> <span class="n">q0</span> <span class="o">-</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">v_air</span><span class="p">)</span><span class="o">*</span><span class="p">(</span> <span class="n">r</span><span class="o">*</span><span class="n">d</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>

    <span class="n">q2</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">-</span> <span class="n">q0</span>        <span class="c1"># Cumulated air flow at y_elev, inside the BL (going speed wise)</span>

    <span class="n">v1</span> <span class="o">=</span> <span class="n">v_air</span><span class="o">*</span><span class="p">(</span><span class="n">q1</span><span class="o">/</span><span class="n">q0</span><span class="p">)</span>     <span class="c1"># Mean speed of q1 air flow at y_elev</span>

    <span class="n">dv</span> <span class="o">=</span> <span class="n">v_air</span> <span class="o">-</span> <span class="n">v1</span>       <span class="c1"># Mean air flow speed variation at y_elev</span>

    <span class="k">return</span> <span class="n">q0</span><span class="p">,</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">dv</span></div>


<span class="c1"># ===========================================================================================================</span>
<div class="viewcode-block" id="specific_air_flows"><a class="viewcode-back" href="../../../../api/marilib.airplane.propulsion.jet_models.html#marilib.airplane.propulsion.jet_models.specific_air_flows">[docs]</a><span class="k">def</span> <span class="nf">specific_air_flows</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Specific air flows and speeds at rear end of a cylinder of radius :math:`R`</span>
<span class="sd">    mouving at :math:`V_{air}` in the direction of :math:`Q_s = \\frac{Q}{\\rho V_{air}} V_s = \\frac{V}{V_{air}}`</span>
<span class="sd">    its axes, :math:`y` is the elevation upon the surface of the cylinder :</span>

<span class="sd">    .. math:: 0 &lt; y &lt; \\infty</span>

<span class="sd">    **WARNING** : even if all mass flows are positive,</span>
<span class="sd">    Q0 and Q1 are going backward in fuselage frame, Q2 is going forward in ground frame.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">7</span> <span class="c1"># exponent in the formula of the speed profile inside a turbulent</span>
            <span class="c1"># BL of thickness d : Vy/Vair = (y/d)^(1/7)</span>

    <span class="n">q0s</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="p">(</span> <span class="n">r</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
                            <span class="c1"># Cumulated specific air flow at y, without BL</span>
    <span class="n">ym</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>

    <span class="n">q1s</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">d</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">ym</span><span class="o">/</span><span class="n">d</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">ym</span><span class="o">/</span><span class="n">d</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
                            <span class="c1"># Cumulated specific air flow at y, without BL</span>
    <span class="k">if</span> <span class="n">y</span><span class="o">&gt;</span><span class="n">d</span><span class="p">:</span>

        <span class="n">q1s</span> <span class="o">=</span> <span class="n">q1s</span> <span class="o">+</span> <span class="n">q0s</span> <span class="o">-</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="p">(</span> <span class="n">r</span><span class="o">*</span><span class="n">d</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
                            <span class="c1"># Add to Q1 the specific air flow outside the BL</span>
    <span class="n">q2s</span> <span class="o">=</span> <span class="n">q0s</span> <span class="o">-</span> <span class="n">q1s</span>
        <span class="c1"># Cumulated specific air flow at y, inside the BL (going speed wise)</span>
    <span class="n">v1s</span> <span class="o">=</span> <span class="p">(</span><span class="n">q1s</span><span class="o">/</span><span class="n">q0s</span><span class="p">)</span> <span class="c1"># Mean specific speed of Q1 air flow at y</span>

    <span class="n">dVs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">v1s</span><span class="p">)</span> <span class="c1"># Mean specific air flow spped variation at y</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">q0s</span><span class="p">,</span><span class="n">q1s</span><span class="p">,</span><span class="n">q2s</span><span class="p">,</span><span class="n">v1s</span><span class="p">,</span><span class="n">dVs</span><span class="p">)</span></div>


<span class="c1"># ===========================================================================================================</span>
<div class="viewcode-block" id="boundary_layer"><a class="viewcode-back" href="../../../../api/marilib.airplane.propulsion.jet_models.html#marilib.airplane.propulsion.jet_models.boundary_layer">[docs]</a><span class="k">def</span> <span class="nf">boundary_layer</span><span class="p">(</span><span class="n">re</span><span class="p">,</span><span class="n">x_length</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Thickness of a turbulent boundary layer which developped turbulently from its starting point</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.385</span><span class="o">*</span><span class="n">x_length</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">re</span><span class="o">*</span><span class="n">x_length</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">5.</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">d</span></div>


<span class="c1"># ===========================================================================================================</span>
<div class="viewcode-block" id="nacelle_generic_drag"><a class="viewcode-back" href="../../../../api/marilib.airplane.propulsion.jet_models.html#marilib.airplane.propulsion.jet_models.nacelle_generic_drag">[docs]</a><span class="k">def</span> <span class="nf">nacelle_generic_drag</span><span class="p">(</span><span class="n">aircraft</span><span class="p">,</span><span class="n">nacelle</span><span class="p">,</span><span class="n">Re</span><span class="p">,</span><span class="n">Mach</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;**WARNING** : nacelle drag returned corresponds to the number of engine : nacelle.n_engine</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">wing</span> <span class="o">=</span> <span class="n">aircraft</span><span class="o">.</span><span class="n">wing</span>

    <span class="n">fac</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">0.126</span><span class="o">*</span><span class="n">Mach</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># All nacelle drag</span>
    <span class="n">nac_nwa</span> <span class="o">=</span> <span class="n">nacelle</span><span class="o">.</span><span class="n">net_wetted_area</span>

    <span class="n">nac_cxf</span> <span class="o">=</span>   <span class="mf">1.15</span><span class="o">*</span><span class="p">((</span><span class="mf">0.455</span><span class="o">/</span><span class="n">fac</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">10.</span><span class="p">)</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Re</span><span class="o">*</span><span class="n">nacelle</span><span class="o">.</span><span class="n">length</span><span class="p">))</span><span class="o">**</span><span class="mf">2.58</span><span class="p">)</span><span class="o">*</span><span class="n">nac_nwa</span><span class="o">/</span><span class="n">wing</span><span class="o">.</span><span class="n">area</span>

    <span class="k">return</span> <span class="n">nac_cxf</span><span class="p">,</span><span class="n">nac_nwa</span></div>


</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">MARILib 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../marilib.html" >marilib</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, T. Druot et al..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0.
    </div>
  </body>
</html>